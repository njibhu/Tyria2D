!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.T3D=e()}}(function(){return function r(i,o,s){function l(a,e){if(!o[a]){if(!i[a]){var t="function"==typeof require&&require;if(!e&&t)return t(a,!0);if(d)return d(a,!0);throw new Error("Cannot find module '"+a+"'")}var n=o[a]={exports:{}};i[a][0].call(n.exports,function(e){var t=i[a][1][e];return l(t||e)},n,n.exports,r,i,o,s)}return o[a].exports}for(var d="function"==typeof require&&require,e=0;e<s.length;e++)l(s[e]);return l}({1:[function(e,t,a){var y=e("../format/file/GW2File.js"),n=e("../format/definition/ANDAT"),i=e("../format/definition/MFT"),f=e("../util/MathUtils.js"),l=e("../MapFileList"),r=function(e,t,a){this.fileListeners=[],this.dat=e,this.version=t,this.logger=a||T3D.Logger};r.prototype.parseHeaderAsync=function(e){this.onFullyLoaded=e,this.loadFilePart(this.dat,0,40,this.readANDatHeader)},r.prototype.connectInflater=function(e,t){var a=this;this.NaClInflater=e,t.addEventListener("message",function(e){a.NaClListener.call(a,e)},!0)},r.prototype.NaClListener=function(a){if("string"!=typeof a.data){var e=a.data[0];this.fileListeners[e]&&(this.fileListeners[e].forEach(function(e){var t=a.data;e(t[1],t[2],t[3],t[4])}),this.fileListeners[e]=null)}else this.logger.log(T3D.Logger.TYPE_WARNING,"NaCl threw an error",a.data)},r.prototype.readANDatHeader=function(e){this.fileHeader=e.readStruct(n),this.logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header",this.fileHeader),this.fileHeader.mftOffset=f.arr32To64(this.fileHeader.mftOffset),this.loadFilePart(this.dat,this.fileHeader.mftOffset,this.fileHeader.mftSize,this.readMFTHeader)},r.prototype.readMFTHeader=function(e){this.mft=e.readStruct(i);e.position;var t=this.mft.nbOfEntries;this.mft.entryDict={offset_0:new Uint32Array(t),offset_1:new Uint32Array(t),offset:new Float64Array(t),size:new Uint32Array(t),compressed:new Uint16Array(t)},this.logger.log(T3D.Logger.TYPE_DEBUG,"reading MFT entries");for(var a=0;a<t-1;a++)this.mft.entryDict.offset_0[a]=e.readUint32(),this.mft.entryDict.offset_1[a]=e.readUint32(),this.mft.entryDict.size[a]=e.readUint32(),this.mft.entryDict.compressed[a]=e.readUint16(),this.mft.entryDict.offset[a]=f.arr32To64([this.mft.entryDict.offset_0[a],this.mft.entryDict.offset_1[a]]),e.seek(e.position+10);var n=f.arr32To64([this.mft.entryDict.offset_0[1],this.mft.entryDict.offset_1[1]]),r=this.mft.entryDict.size[1];this.loadFilePart(this.dat,n,r,this.readMFTIndexFile)},r.prototype.readMFTIndexFile=function(e,t){var a=t/8,n=new Uint32Array(a),r=new Uint32Array(a),i=new Uint32Array(a),o=new Uint32Array(a);this.mft.baseToMft=new Uint32Array(2e6),this.mft.fileToMft=new Uint32Array(2e6);for(var s=0;s<a;s++)n[s]=e.readUint32(),r[s]=e.readUint32();this.mft.id2index={ids:n,mftIndices:r};for(s=0;s<a;s++)if(0!=n[s]||0!=r[s]){var l=r[s],d={fileId:o[l],baseId:i[l]};if(0==d.baseId?d.baseId=n[s]:0==d.fileId&&(d.fileId=n[s]),0<d.baseId&&0<d.fileId&&d.baseId>d.fileId){var f=d.baseId;d.baseId=d.fileId,d.fileId=f}this.mft.baseToMft[d.baseId]=l,o[this.mft.fileToMft[d.fileId]=l]=d.fileId,i[l]=d.baseId}this.mft.m_entryToId={baseId:i,fileId:o},this.logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT ",this.mft),this.onFullyLoaded&&this.onFullyLoaded()},r.prototype.loadFileList=function(){var e=this.dat,t="fileList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size,a=localStorage.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(e){}return null},r.prototype.loadMapList=function(){var e=this.dat,t="mapList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size,a=localStorage.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(e){}return null},r.prototype.storeFileList=function(e,t){var a=JSON.stringify(t),n="fileList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size;localStorage.setItem(n,a)},r.prototype.storeMapList=function(e,t){var a="mapList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size;localStorage.setItem(a,JSON.stringify(t))},r.prototype.readFileListAsync=function(t){var a=this,e=this.mft.id2index.mftIndices,n=f.sort_unique(e,function(e,t){return a.mft.entryDict.offset[e]-a.mft.entryDict.offset[t]}),r=n.length;this.logger.log(T3D.Logger.TYPE_DEBUG,"Scanning ",r,"files");this.listFiles(n,null,0,r,8,function(e){a.fileListeners=[],a.storeFileList(a.dat,e),t(e)})},r.prototype.readMapListAsync=function(e,a){var o=this,n=this.dat,r=[],s=(new Date).getTime();this.logger.log(T3D.Logger.TYPE_PROGRESS,"Finding maps (first visit only)","initializing"),e?r=this.mft.id2index.mftIndices:l.maps.forEach(function(e){e.maps.forEach(function(e){var t=e.fileName.split(".")[0],a=o.getFileIndex(t);r.push(a)})});var t=f.sort_unique(r,function(e,t){return o.mft.entryDict.offset[e]-o.mft.entryDict.offset[t]}),i=t.length;this.logger.log(T3D.Logger.TYPE_DEBUG,"Scanning ",i," files for maps..."),this.listFiles(t,"mapc",0,i,8,function(e){var t=(new Date).getTime()-s;o.logger.log(T3D.Logger.TYPE_DEBUG,"Time elapsed ",Math.round(.001*t)," seconds"),o.fileListeners=[];var i={maps:[]};e.mapc&&e.mapc.forEach(function(e){var a=o.mft.m_entryToId.baseId[e+1],n="",r="";l.maps.forEach(function(t){t.maps.forEach(function(e){0==n.length&&0<=e.fileName.indexOf(a+".")&&(n=e.name,r=t.name)})}),0==n.length&&(n="Unknown map "+a),0==r.length&&(r="Unknown maps");var t=null;i.maps.forEach(function(e){e.name==r&&(t=e)}),t||(t={name:r,maps:[]},i.maps.push(t)),t.maps.push({fileName:a,name:n})}),o.storeMapList(n,i),a(i)})},r.prototype.listFiles=function(o,s,l,e,d,f){for(var m=this,u=l+e,h=0,c=100/Math.min(e,o.length-l),p=0,g={},v=function(a){if(a%d==0){var e=Math.min(100,Math.floor((a-l)*c));h!=e&&(m.logger.log(T3D.Logger.TYPE_PROGRESS,"Find type",e),h=e)}if(a>=o.length||u<=a)return m.logger.log(T3D.Logger.TYPE_DEBUG,"Thread ",a%d+" done"),void(++p==d&&f(g));var n=o[a];if(m.mft.entryDict.compressed[n]){var r=n,t=m.mft.entryDict.offset[n],i=m.mft.entryDict.size[n];i<32?v(a+d):m.loadFilePart(m.dat,t,Math.min(i,2e3),function(e,t){m.inflate(e,t,r,function(e){!function(e,t,a){if(!e)return m.logger.log(T3D.Logger.TYPE_WARNING,"No infalted data for entry"),v(t+d);var n,r=new DataStream(e),i=r.readCString(4);n="ATEX"==i||"ATEC"==i||"ATEP"==i||"ATET"==i||"ATEU"==i||"ATTX"==i?"Texture":0==i.indexOf("PF")?new y(r,0,!0).header.type:0==i.indexOf("MZ")?"Binary":"strs"==i?"String":"Unknown";s&&n!=s||(g[n]||(g[n]=[]),g[n].push(a)),v(t+d)}(e,a,n)},!1,32)})}else v(a+d)},t=0;t<d;t++)v(l+t)},r.prototype.getFileIndex=function(e){var t=-1;return e=parseInt(e),-1!=(t=this.mft.m_entryToId.baseId.indexOf(e))?t-1:-1!=(t=this.mft.m_entryToId.fileId.indexOf(e))?t-1:t},r.prototype.loadTextureFile=function(e,t){this.loadFile(e,t,!0)},r.prototype.loadFile=function(e,a,n,r){var i=this,t=this.getFileIndex(e),o=t;if(o<=0)return i.logger.log(T3D.Logger.TYPE_WARNING,"Could not find file with baseId ",e),void a(null);var s=f.arr32To64([this.mft.entryDict.offset_0[o],this.mft.entryDict.offset_1[o]]),l=this.mft.entryDict.size[o];if(!this.mft.entryDict.compressed[o])return i.logger.log(T3D.Logger.TYPE_WARNING,"File is NOT compressed, skipping"),void a(null);var d=t;this.loadFilePart(this.dat,s,l,function(e,t){r?a(e):i.inflate(e,t,d,a,n)})},r.prototype.inflate=function(e,t,a,n,r,i){var o=e.buffer;if(i||(i=1),o.byteLength<12)return this.logger.log(T3D.Logger.TYPE_WARNING,"not inflating, length is too short ("+o.byteLength+")",a),void n(null);123350!=a&&123409!=a&&123408!=a?this.fileListeners[a]?this.fileListeners[a].push(n):(this.fileListeners[a]=[n],this.NaClInflater.postMessage([a,o,!0===r,i])):n(null)},r.prototype.loadFilePart=function(e,t,n,r){var i=this,a=new FileReader;a.onerror=function(e){},a.onload=function(e){var t=e.target.result,a=new DataStream(t);a.endianness=DataStream.LITTLE_ENDIAN,r.call(i,a,n)};var o=t,s=o+n;a.readAsArrayBuffer(e.slice(o,s))},t.exports=r},{"../MapFileList":3,"../format/definition/ANDAT":13,"../format/definition/MFT":14,"../format/file/GW2File.js":16,"../util/MathUtils.js":18}],2:[function(e,t,a){var n={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};n.logFunctions=new Array(5),n.log=function(){if(0!=arguments.length){var e=n.argsToArr(arguments);1==e.length&&e.unshift(n.TYPE_MESSAGE);var t=Math.max(0,Math.min(n.logFunctions.length,e.shift()));n.logFunctions[t].apply(this,e)}},n.argsToArr=function(e){for(var t=new Array(e.length),a=0;a<t.length;++a)t[a]=e[a];return t},n.logFunctions[n.TYPE_ERROR]=function(){console.error.apply(console,arguments)},n.logFunctions[n.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},n.logFunctions[n.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},n.logFunctions[n.TYPE_PROGRESS]=function(){var e=n.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},n.logFunctions[n.TYPE_DEBUG]=function(){var e=n.argsToArr(arguments);console.debug.apply(console,e)},t.exports=n},{}],3:[function(e,t,a){t.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove"},{fileName:"198272.data",name:"Rata Sum"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"736241.data",name:"Edge of the Mists"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],4:[function(e,t,a){function l(){}LocalReader=e("./LocalReader/LocalReader.js"),t.exports=l;var n,d="1.1.0",f="modules/nacl/t3dgwtools.nmf",m="modules/t3dtools/t3dworker.js";l.version=d,l.GW2File=e("./format/file/GW2File"),l.GW2Chunk=e("./format/file/GW2Chunk"),l.DataRenderer=e("./dataRenderer/DataRenderer"),l.EnvironmentRenderer=e("./dataRenderer/EnvironmentRenderer"),l.HavokRenderer=e("./dataRenderer/HavokRenderer"),l.PropertiesRenderer=e("./dataRenderer/PropertiesRenderer"),l.ModelRenderer=e("./dataRenderer/ModelRenderer"),l.TerrainRenderer=e("./dataRenderer/TerrainRenderer"),l.ZoneRenderer=e("./dataRenderer/ZoneRenderer"),l.StringRenderer=e("./dataRenderer/StringRenderer"),l.Logger=e("./Logger"),l.MapFileList=e("./MapFileList"),l.MaterialUtils=e("./util/MaterialUtils.js"),l.MathUtils=e("./util/MathUtils.js"),l.ParserUtils=e("./util/ParserUtils.js"),l.RenderUtils=e("./util/RenderUtils.js"),l.getLocalReader=function(e,t,a,n,r){if(void 0===navigator.mimeTypes["application/x-nacl"]){var i=new Worker(r||m);(s=new LocalReader(e,d,n)).connectInflater(i,i)}else{var o=document.createElement("div");o.setAttribute("id","pNaClListener");var s,l=document.createElement("embed");l.setAttribute("type","application/x-pnacl"),l.style.position="absolute",l.style.height=0,l.style.width=0,l.setAttribute("src",a||f),o.appendChild(l),document.body.appendChild(o),(s=new LocalReader(e,d,n)).connectInflater(l,o)}return s.parseHeaderAsync(t),s},l.getFileListAsync=function(e,t){var a=e.loadFileList();a?t(a):e.readFileListAsync(t)},l.getMapListAsync=function(e,t,a){if(a)e.readMapListAsync(!0,t);else{var n=e.loadMapList();n?t(n):e.readMapListAsync(!1,t)}},l.renderMapContentsAsync=function(r,e,i,o,t){var s={};parseInt(e)?r.loadFile(e,function(e){var t=new DataStream(e,0,DataStream.LITTLE_ENDIAN),a=new l.GW2File(t,0),n=function(e){e<i.length?l.runRenderer(i[e].renderClass,r,Object.assign(i[e].settings,{mapFile:a}),s,n.bind(this,e+1)):o(s)};n(0)}):(t||l.Logger).log(l.Logger.TYPE_ERROR,"Map id must be an integer!, was:",e)},l.runRenderer=function(e,t,a,n,r){new e(t,a,n).renderAsync(r)},l.getContextValue=function(e,t,a,n){var r=e[t.name];return r&&r[a]?r[a]:n},l.hasWebGL=function(e){if(window.WebGLRenderingContext){for(var t=document.createElement("canvas"),a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],n=!1,r=0;r<4;r++)try{if((n=t.getContext(a[r]))&&"function"==typeof n.getParameter)return!e||{name:a[r],gl:n}}catch(e){}return!1}return!1},n=0,"undefined"==typeof DataStream&&(l.Logger.log(l.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),n++),"undefined"==typeof THREE&&(l.Logger.log(l.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),n++),n<1&&l.Logger.log(l.Logger.TYPE_MESSAGE,"Tyria 3D API v"+l.version+" initialized.")},{"./LocalReader/LocalReader.js":1,"./Logger":2,"./MapFileList":3,"./dataRenderer/DataRenderer":5,"./dataRenderer/EnvironmentRenderer":6,"./dataRenderer/HavokRenderer":7,"./dataRenderer/ModelRenderer":8,"./dataRenderer/PropertiesRenderer":9,"./dataRenderer/StringRenderer":10,"./dataRenderer/TerrainRenderer":11,"./dataRenderer/ZoneRenderer":12,"./format/file/GW2Chunk":15,"./format/file/GW2File":16,"./util/MaterialUtils.js":17,"./util/MathUtils.js":18,"./util/ParserUtils.js":19,"./util/RenderUtils.js":20}],5:[function(e,t,a){var d=e("../format/file/GW2File"),n=t.exports=function(e,t,a,n){this.localReader=e,(this.settings=t)||(t={}),this.context=a,this.context[this.constructor.name]={},this.logger=n||T3D.Logger};n.prototype.getOutput=function(e){return this.context[e?e.name:this.constructor.name]},n.prototype.renderAsync=function(s){var l=this;this.localReader.loadFile(this.settings.id,function(e){l.getOutput().fileId=l.settings.id,l.getOutput().rawData=e;for(var t=new Uint8Array(e),a=[],n=Math.min(t.length,1e4),r=0;65535*r<n;r++)a.push(String.fromCharCode.apply(null,t.subarray(65535*r,65535*(r+1))));n<t.length&&a.push("T3D Ignored the last "+(t.length-n)+" bytes when generating this raw output"),l.getOutput().rawString=a.join();var i=new DataStream(e),o=i.readCString(4);"ATEX"==o||"ATEC"==o||"ATEP"==o||"ATET"==o||"ATEU"==o||"ATTX"==o?l.localReader.loadTextureFile(l.settings.id,function(e,t,a,n){var r={data:new Uint8Array(e),width:a,height:n};l.getOutput().image=r,s()}):(0==o.indexOf("PF")?l.getOutput().file=new d(i,0):l.getOutput().file=null,s())})}},{"../format/file/GW2File":16}],6:[function(e,t,a){var d=e("../util/RenderUtils"),n=e("./DataRenderer");function r(l,e,t,a){n.call(this,l,e,t,a),this.mapFile=this.settings.mapFile,this.getMat=function(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})},this.loadTextureWithFallback=function(e,a,t,n,r){var i=this;function o(t){e.forEach(function(e){a[e]=t})}function s(){o(i.getMat((new THREE.TextureLoader).load(n)))}o(i.getMat(d.loadLocalTexture(l,t,null,r,function(){setTimeout(s,1)})))},this.getHazeColor=function(e){var t=e&&e.dataGlobal.haze;return!t||t.length<=0?[190,160,60]:t[0].farColor},this.parseLights=function(e){var r=this;r.getOutput().lights=[];var n,t=e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}],i=!1;t.forEach(function(e,t){if(!i){if(e.lights.forEach(function(e,t){i=!0;var a=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),n=new THREE.DirectionalLight(a.getHex(),e.intensity);n.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),e.intensity,r.getOutput().lights.push(n)}),!e.lights||0==e.lights.length){[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]].forEach(function(e){var t=new THREE.Color(1,1,1),a=e[3],n=new THREE.DirectionalLight(t.getHex(),a);n.position.set(e[0],e[1],e[2]).normalize(),a,r.getOutput().lights.push(n)})}e.backlightIntensity=e.backlightIntensity;var a=new THREE.Color(e.backlightIntensity*(255-e.backlightColor[2])/255,e.backlightIntensity*(255-e.backlightColor[1])/255,e.backlightIntensity*(255-e.backlightColor[0])/255);n=new THREE.AmbientLight(a)}});var a=0;n&&(a=n.color.r+n.color.g+n.color.b,this.getOutput().lights.push(n)),this.getOutput().hasLight=i||0<a},this.parseSkybox=function(e,t,a){this.getOutput().skyElements=[];var n=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];n||(n={texPathNE:1930687,texPathSW:193069,texPathT:193071});var r=t.rect,i=Math.abs(r.x1-r.x2),o=Math.abs(r.y1-r.y2),s=(Math.max(i,o),[]);this.loadTextureWithFallback([1,4],s,n.texPathNE+1,"img/193068.png",a),this.loadTextureWithFallback([0,5],s,n.texPathSW+1,"img/193070.png",a),this.loadTextureWithFallback([2],s,n.texPathT+1,"img/193072.png",a),s[3]=new THREE.MeshBasicMaterial({visible:!1});var l=new THREE.BoxGeometry(1024,512,1024);l.faceVertexUvs[0].forEach(function(e,t){var a=Math.floor(t/2);0==a||1==a?e.forEach(function(e){e.x=1-e.x,e.y/=2,e.y+=.5}):5==a||4==a?e.forEach(function(e){e.y/=-2,e.y+=.5}):e.forEach(function(e){e.x=1-e.x})}),l.uvsNeedUpdate=!0;var d=new THREE.Mesh(l,s);d.translateY(256),this.getOutput().skyElements.push(d)}}((r.prototype=Object.create(n.prototype)).constructor=r).prototype.renderAsync=function(e){var t=this.mapFile.getChunk("env").data,a=this.mapFile.getChunk("parm").data,n=this.getHazeColor(t),r=256*n[2]*256+256*n[1]+n[0];this.getOutput().hazeColor=n,this.parseLights(t),this.parseSkybox(t,a,r),e()},t.exports=r},{"../util/RenderUtils":20,"./DataRenderer":5}],7:[function(e,t,a){var r=e("./DataRenderer");function n(e,t,a,n){r.call(this,e,t,a,n),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[],this.renderModels=function(e,t,a){var n;n=this.settings&&this.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),this.parseAllModels(e,n,t,200,0,a)},this.getCollisionsForAnimation=function(e,t){for(var a=[],n=0;n<e.collisionIndices.length;n++){var r=e.collisionIndices[n],i=t[r];i.index=r,a.push(i)}return a},this.parseAllModels=function(e,t,a,n,r,i){for(var o=r;o<r+n&&o<e.length;o++){var s=Math.round(100*o/e.length);s!=this.lastP&&(this.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+a+")",s),this.lastP=s);for(var l=this.animationFromGeomIndex(e[o].geometryIndex,this.geometries,this.animations),d=this.getCollisionsForAnimation(l,this.havokChunkData.collisions),f=0;f<d.length;f++){var m=d[f];this.renderMesh(m,e[o],t)}}o<e.length?window.setTimeout(this.parseAllModels.bind(this,e,t,a,n,r+n,i),10):i()},this.animationFromGeomIndex=function(e,t,a){var n=t[e].animations.length;return a[t[e].animations[n-1]]},this.renderMesh=function(e,t,a){var n=t.translate,r=t.rotate,i=32*t.scale,o=this.parseHavokMesh(e,a);o.position.set(n[0],-n[2],-n[1]),i&&o.scale.set(i,i,i),r&&(o.rotation.order="ZXY",o.rotation.set(r[0],-r[2],-r[1])),this.getOutput().meshes.push(o)},this.seedRandom=function(){var e=1e4*Math.sin(this.seed++);return e-Math.floor(e)},this.parseHavokMesh=function(e,t){var a=e.index;if(this.meshes[a])return this.meshes[a].clone();for(var n=new THREE.Geometry,r=0;r<e.vertices.length;r++){var i=e.vertices[r];n.vertices.push(new THREE.Vector3(i[0],i[2],-i[1]))}for(r=0;r<e.indices.length;r+=3){var o=e.indices[r],s=e.indices[r+1],l=e.indices[r+2];o<=e.vertices.length&&s<=e.vertices.length&&l<=e.vertices.length?n.faces.push(new THREE.Face3(o,s,l)):this.logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return n.computeFaceNormals(),this.meshes[a]=new THREE.Mesh(n,t),this.meshes[a]}}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(e){var t=this;this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[],this.getOutput().meshes=[];var a=this.havokChunkData.propModels,n=this.havokChunkData.zoneModels,r=this.havokChunkData.obsModels;r.forEach(function(e){e.scale=1}),this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;var i=function(){t.renderModels(r,"obs",e)};t.renderModels(a,"prop",function(){t.renderModels(n,"zone",i)})},t.exports=n},{"./DataRenderer":5}],8:[function(e,t,a){var o=e("../util/RenderUtils"),r=e("./DataRenderer");function n(e,t,a,n){r.call(this,e,t,a,n)}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(n){var r=this,e=this.settings.id,i={};r.getOutput().meshes=[],o.getMeshesForFilename(e,65280,r.localReader,i,{},!0,function(e,t,a){e&&e.forEach(function(e){e.boundingSphere=a,r.getOutput().meshes.push(e)}),i={},n()})},t.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],9:[function(e,t,a){var l=e("../util/RenderUtils"),r=e("./DataRenderer");function n(e,t,a,n){r.call(this,e,t,a,n),this.mapFile=this.settings.mapFile}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(a){var u=this;u.getOutput().meshes=[];var e=this.mapFile.getChunk("prp2").data;if(e){var n=e.propArray,t=e.propAnimArray,r=e.propInstanceArray,i=e.propMetaArray;n=n.concat(t).concat(r).concat(i),u.meshCache={},u.textureCache={};var o=-1,h=function(d){if(d>=n.length)return u.meshCache={},u.textureCache={},void a();var e=Math.round(1e3*d/n.length);if(o!=(e/=10)){var t=e+(e.toString().indexOf(".")<0?".0":"");u.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",t),o=e}var f=n[d],m=function(e,t,a,n,r){var i=0!=n.lod2?n.lod2:e.lodOverride[1];if(0==e.flags&&(i=0),r&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,t[i])t[i].add(e);else{var o=new THREE.Group;o.updateMatrix(),o.matrixAutoUpdate=!1,o.add(e),t[i]=o,a.addLevel(o,i)}return i};l.getMeshesForFilename(f.filename,f.color,u.localReader,u.meshCache,u.textureCache,!1,function(e,t,a){var r,n,i,o,s,l;e&&(r=e,n=t,i=a,o={},s=new THREE.LOD,l=0,r.forEach(function(e){l=Math.max(l,m(e,o,s,f,n))}),f.rotation&&(s.rotation.order="ZXY",s.rotation.set(f.rotation[0],-f.rotation[2],-f.rotation[1])),s.scale.set(f.scale,f.scale,f.scale),s.position.set(f.position[0],-f.position[2],-f.position[1]),s.boundingSphereRadius=(i&&i.radius?i.radius:1)*f.scale,s.updateMatrix(),s.matrixAutoUpdate=!1,u.getOutput().meshes.push(s),f.transforms&&f.transforms.forEach(function(e){var t={},a=new THREE.LOD,n=0;r.forEach(function(e){n=Math.max(n,m(e,t,a,f,!0))}),e.rotation&&(a.rotation.order="ZXY",a.rotation.set(e.rotation[0],-e.rotation[2],-e.rotation[1])),a.scale.set(e.scale,e.scale,e.scale),a.position.set(e.position[0],-e.position[2],-e.position[1]),a.updateMatrix(),a.matrixAutoUpdate=!1,a.boundingSphereRadius=(i&&i.radius?i.radius:1)*f.scale,a.update(a),u.getOutput().meshes.push(a)})),h(d+1)})};h(0)}else renderCallback()},n.prototype.getFileIdsAsync=function(a){var n=[],e=this.mapFile.getChunk("prp2").data,r=e.propArray,t=e.propAnimArray,i=e.propInstanceArray,o=e.propMetaArray;r=r.concat(t).concat(i).concat(o);var s=function(t){if(t>=r.length)a(n);else{t%100==0&&this.logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",t,"of",r.length);var e=r[t];l.getFilesUsedByModel(e.filename,localReader,function(e){n=n.concat(e),s(t+1)})}};s(0)},t.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],10:[function(e,t,a){e("../util/RenderUtils");var r=e("./DataRenderer");function n(e,t,a,n){r.call(this,e,t,a,n)}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(s){var l=this;this.settings.id;this.getOutput().strings=[],this.localReader.loadFile(this.settings.id,function(e){var t=new DataStream(e),a=t.byteLength-2;t.seek(4);for(var n=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],r=0;6<a-t.position;){var i=t.readStruct(n);if(i.size-=6,0<i.size)if(!(0!=i.decryptionOffset||16!=i.bitsPerSymbol)){var o=t.readUCS2String(i.size/2);l.getOutput().strings.push({value:o,recid:r})}r++}t.seek(t.byteLength-2),l.getOutput().language=t.readUint16(),s()})},t.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],11:[function(e,t,a){var z=e("../util/RenderUtils"),i=e("./DataRenderer"),d=e("../format/file/GW2File.js"),Y=e("../util/TerrainShader.js");function n(e,t,a,n,r){i.call(this,e,t,a,n,r),this.mapFile=this.settings.mapFile,this.drawWater=function(e){var t=t||new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35});return t.transparent=!0,z.renderRect(e,0,t)},this.parseNumChunks=function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1},this.loadPagedImageCallback=function(n,e){var A=this;A.getOutput().terrainTiles=[];var t=new DataStream(e),a=new d(t,0).getChunk("pgtb"),r=a&&a.data;this.mapRect=null;var S=this.mapFile.getChunk("trn").data,C=this.mapFile.getChunk("parm").data,L=this.settings.anisotropy?this.settings.anisotropy:1;this.parseNumChunks(S);var P=S.numChunksD_1,i=S.numChunksD_2,H=S.materials.materials,U=S.materials.texFileArray,o=C.rect[2]-C.rect[0],s=C.rect[3]-C.rect[1],I=o/S.numChunksD_1*1,O=s/S.numChunksD_2*1,_=0,G=[],W=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,flatShading:!0}),B={};r&&r.strippedPages.forEach(function(e){if(e.layer<=1){var t=e.filename,a=(e.solidColor,e.coord),n=a[0]+","+a[1];if(1==e.layer&&(n+="-2"),!B[n]){var r=z.loadLocalTexture(A.localReader,t);r&&(r.anisotropy=L,r.wrapS=THREE.RepeatWrapping,r.wrapT=THREE.RepeatWrapping),B[n]=r}}});var l=function(e,t){if(P<=e&&(e=0,t++),i<=t)return A.getOutput().water=A.drawWater(A.mapRect),A.getOutput().bounds=A.mapRect,void n();var a=Math.floor(100*(t*P+e)/(P*i));A.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",a),function(e,t){for(var a,n=t*P+e,r=Math.floor(e/4),i=Math.floor(t/4),o=H[n].loResMaterial.texIndexArray,s=(H[n].loResMaterial.materialFile,S.chunkArray[n],U[o[0]],e%4/4),l=.75-t%4/4,d=[],f=0;f<o.length/2;f++){var m=U[o[f]].filename;if(d.push(m),!B[m]){var u=z.loadLocalTexture(A.localReader,m);u&&(u.anisotropy=L,u.wrapS=THREE.RepeatWrapping,u.wrapT=THREE.RepeatWrapping),B[m]=u}}var h=r+","+i,c=r+","+i+"-2",p={color:{r:1,g:1,b:1},near:0,far:0},g=A.getOutput(T3D.EnvironmentRenderer);g.hazeColor&&(p.color.r=g.hazeColor[2]/255,p.color.g=g.hazeColor[1]/255,p.color.b=g.hazeColor[0]/255);var v=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);v.uvScale={type:"v2",value:new THREE.Vector2(8,8)},v.offset={type:"v2",value:new THREE.Vector2(s,l)},v.texturePicker={type:"t",value:B[h]},v.texturePicker2={type:"t",value:B[c]},v.texture1={type:"t",value:B[d[0]]},v.texture2={type:"t",value:B[d[1]]},v.texture3={type:"t",value:B[d[2]]},v.texture4={type:"t",value:B[d[3]]},a=new THREE.ShaderMaterial({uniforms:v,fragmentShader:Y.fragmentShader,vertexShader:Y.vertexShader}),G.push(a);for(var y=new THREE.PlaneBufferGeometry(I,O,32,32),E=0,R=0;R<35;R++)for(var T=0;T<35;T++)0!=T&&34!=T&&0!=R&&34!=R&&(y.attributes.position.array[3*E+2]=S.heightMapArray[_],E++),_++;var N,x=(new THREE.Matrix4).identity();x.elements[5]=-1,y.applyMatrix(x),y.computeFaceNormals(),N=new THREE.Mesh(y,W),(N=a.length?THREE.SceneUtils.createMultiMaterialObject(y,a):new THREE.Mesh(y,a)).rotation.set(Math.PI/2,0,0);var M=C.rect[0]+I/2,w=e*I;if(N.position.x=M+w,S.numChunksD_2%2==0){var F=C.rect[1]+O/2-0,D=t*O*1;N.position.z=D+F}else F=C.rect[1]-O/2+0,D=t*O*1,N.position.z=F+D;var k=N.position.x,b=N.position.z;A.mapRect||(A.mapRect={x1:k-I/2,x2:k+I/2,y1:b-O/2,y2:b+O/2}),A.mapRect.x1=Math.min(A.mapRect.x1,k-I/2),A.mapRect.x2=Math.max(A.mapRect.x2,k+I/2),A.mapRect.y1=Math.min(A.mapRect.y1,b-O/2),A.mapRect.y2=Math.max(A.mapRect.y2,b+O/2),N.updateMatrix(),N.updateMatrixWorld(),A.getOutput().terrainTiles.push(N)}(e,t),setTimeout(l,1,e+1,t)};l(0,0)}}((n.prototype=Object.create(i.prototype)).constructor=n).prototype.renderAsync=function(e){var t=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.loadFile(t,this.loadPagedImageCallback.bind(this,e))},n.prototype.getFileIdsAsync=function(e){var t=this.mapFile.getChunk("trn"),a=this.mapFile.getChunk("pimg"),n=[];return(a&&a.data).strippedPages.forEach(function(e){e.layer<=1&&0<e.filename&&n.push(e.filename)}),t.data.materials.texFileArray.forEach(function(e){0<e.filename&&n.push(e.filename)}),n},t.exports=n},{"../format/file/GW2File.js":16,"../util/RenderUtils":20,"../util/TerrainShader.js":21,"./DataRenderer":5}],12:[function(e,t,a){var l=e("../util/RenderUtils"),r=e("./DataRenderer");function n(e,t,a,n){r.call(this,e,t,a,n),this.mapFile=this.settings.mapFile,this.renderZone=function(t,e,a,r){var i=this,n=null;e.forEach(function(e){n||e.token!=t.defToken||(n=e)});var o=this.getModelGroups(t,n,a);i.meshCache={},i.textureCache={};var s=Object.keys(o);!function a(n){if(n>=s.length)return i.meshCache={},i.textureCache={},void r();var e=s[n],N=o[e],x=[];l.getMeshesForFilename(e,null,i.localReader,i.meshCache,i.textureCache,!1,function(e,t){e&&N.forEach(function(R,T){e.forEach(function(e,t){if(525!=e.materialFlags){var a={x:0,y:0,z:0};if(x[t])a.x=R.x-x[t].position.x,a.y=R.z-x[t].position.z,a.z=R.y-x[t].position.y;else{var n=e.geometry.clone(),r=n.attributes;x[t]={readVerts:r.position.array,verts:new Float32Array(N.length*r.position.array.length),readIndices:n.getIndex().array,indices:new Uint32Array(N.length*n.getIndex().array.length),readUVs:r.uv.array,uvs:new Float32Array(N.length*r.uv.array.length),readNormals:r.normal.array,normals:new Float32Array(N.length*r.normal.array.length),material:e.material,position:{x:R.x,y:R.y,z:R.z}}}for(var i=x[t].readVerts,o=x[t].verts,s=i.length,l=0,d=T*s;l<s;l+=3,d+=3)o[d+0]=i[l+0]+a.x,o[d+1]=i[l+1]+a.y,o[d+2]=i[l+2]+a.z;var f=x[t].readIndices,m=x[t].indices,u=f.length,h=s*T/3;for(l=0,d=T*u;l<u;l++,d++)m[d]=f[l]+h;var c=x[t].readUVs,p=x[t].uvs,g=c.length;for(l=0,d=T*g;l<g;l++,d++)p[d]=c[l];var v=x[t].readNormals,y=x[t].normals,E=v.length;for(l=0,d=T*E;l<E;l++,d++)y[d]=v[l]}})}),x.forEach(function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.verts,3)),t.setIndex(new THREE.BufferAttribute(e.indices,1)),t.addAttribute("normal",new THREE.BufferAttribute(e.normals,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvs,2)),t.buffersNeedUpdate=!0,mesh=new THREE.Mesh(t,e.material),mesh.position.set(e.position.x,e.position.z,e.position.y),i.getOutput().meshes.push(mesh)}),a(n+1)})}(0)},this.getModelGroups=function(e,t,a){e.zPos;var n=a[0],r=a[1],i=48*e.vertRect[0]+n,o=(e.vertRect[2],-48*e.vertRect[1]-r);e.vertRect[3];if(0==e.encodeData.length)return{};for(var s=e.vertRect[0]-e.vertRect[2],l=(e.vertRect[1],e.vertRect[3],0),d={},f=this.getOutput(T3D.TerrainRenderer).terrainTiles,m=0;m<e.flags.length;m+=2){l+=e.flags[m];var u=e.flags[m+1];if(0!=u){var h=u>>4,c=t.layerDefArray[h-1];if(c){var p=l%s*48+i,g=48*Math.floor(l/s)+o,v=null,y=new THREE.Raycaster(new THREE.Vector3(p,1e5,g),new THREE.Vector3(0,-1,0));f.forEach(function(e){if(null===v){var t=y.intersectObject(e);0<t.length&&(v=1e5-t[0].distance)}});var E=c.modelArray[0],R=E.filename,T=(E.zOffsets,c.layerFlags,c.rotRangeX),N=c.rotRangeY,x=c.rotRangeZ,M=c.scaleRange,w=c.fadeRange;d[R]||(d[R]=[]),d[R].push({x:p,y:g,z:v,rotRangeX:T,rotRangeY:N,rotRangeZ:x,scaleRange:M,fadeRange:w})}}}return d}}((n.prototype=Object.create(r.prototype)).constructor=n).prototype.renderAsync=function(n){var r=this;r.getOutput().meshes=[];var e=this.mapFile.getChunk("zon2").data,t=this.mapFile.getChunk("parm").data,i=(this.mapFile.getChunk("trn").data,t.rect),o=e.zoneArray,s=e.zoneDefArray;lastPct=-1,function e(t){var a=Math.round(100*t/o.length);lastPct!=a&&(r.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",a),lastPct=a),t>=o.length?n():r.renderZone(o[t],s,i,e.bind(r,t+1))}(0)},t.exports=n},{"../util/RenderUtils":20,"./DataRenderer":5}],13:[function(e,t,a){t.exports=["version","uint8","magic","string:3","headerSize","uint32","unknown1","uint32","chunkSize","uint32","crc","uint32","unknown2","uint32","mftOffset",["[]","uint32",2],"mftSize","uint32","flags","uint32"]},{}],14:[function(e,t,a){t.exports=["magic","string:4","unknown1",["[]","uint32",2],"nbOfEntries","uint32","unknown2","uint32","unknown3","uint32"]},{}],15:[function(e,t,a){var n=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"],o={ANIM:["MODL","Unknown"],GAME:["MODL","Unknown"],Main:["cntc","mMet"],SKEL:["MODL","Unknown"],TOOL:["AMAT","MODL"],main:["Unknown","Unknown","cmaC"],nvms:["Unknown","Unknown"]},r=function(e,t){this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.loadHead()};r.prototype.loadHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr},r.prototype.getDefinition=function(e){var t=0,a=o[this.header.type];if(a){t=-1;for(var n=0;n<a.length&&-1==t;n++){a[n]==e&&(t=n)}}var r=0;for(n=0;n<T3D.formats.length;n++){var i=T3D.formats[n];if(i.name==this.header.type){if(r==t&&i.versions[this.header.chunkVersion])return(new i.versions[this.header.chunkVersion]).__root;r++}}},r.prototype.loadData=function(e){var t=this.getDefinition(e);t?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(t)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)},r.prototype.next=function(){try{return new r(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null},t.exports=r},{}],16:[function(e,t,a){var n=e("./GW2Chunk"),r=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"],i=function(e,t,a){this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),a||this.readChunks()};i.prototype.readHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(r),this.headerLength=this.ds.position-this.addr},i.prototype.readChunks=function(){this.chunks=[];for(var e=new n(this.ds,this.headerLength+this.addr);null!=e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()},i.prototype.getChunk=function(e){for(var t=0;t<this.chunks.length;t++)if(this.chunks[t].header.type.toLowerCase()==e.toLowerCase())return this.chunks[t];return null},i.prototype.getChunkStructs=function(){return{}},t.exports=i},{"./GW2Chunk":15}],17:[function(e,t,a){var n=t.exports={};n.getMaterial=function(e,t,n,r){if(t){var a,i=t.getChunk("dx9s"),o=t.getChunk("grmt"),s=[];if(e&&e.textures.length){for(var l=i.data.techniques[0].passes[0].effects[0],d=(i.data.shaders[l.pixelShader],[]),f=0;f<l.samplerIndex.length;f++){var m=l.samplerIndex[f],u=i.data.samplers[m];if(u){var h=u&&o.data.texTokens[u.textureIndex];h||(h="0-0");var c=null;if(e.textures.forEach(function(e,t){c||e.token.split("-")[0]!=h.split("-")[0]||(c=e)}),c)d.push(c);else if(u)d.push(e.textures[u.textureIndex]);else{if(!(0<e.textures.length))return;d.push(e.textures[0])}}}if(d.length<=0)return;d.forEach(function(e,t){if(e){var a=e&&e.filename;s[t]=y(a,n,r),s[t]&&(s[t].uvIdx=e.uvPSInputIndex)}})}if(s){var p=!1,g=!1;if(e.textures.forEach(function(e){p||"1733499172"!=e.token.split("-")[0]||(p=e),g||"404146670"!=e.token.split("-")[0]||(g=e)}),!p||p.filename<=0)return;if(a=new THREE.MeshPhongMaterial({side:THREE.FrontSide,map:y(p.filename,n,r)}),g){var v=y(g.filename,n,r);v.flipY=!0,a.normalMap=v}a.textureFilename=p.filename,16460!=o.data.flags&&(a.alphaTest=.05)}else a=new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:16711680,shading:THREE.FlatShading});if(a.needsUpdate=!0,e){o=t.getChunk("grmt");1&e.materialFlags||16&e.materialFlags||e.materialFlags;[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(o.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",o.data.flags),8&o.data.flags||(a=new THREE.MeshBasicMaterial({side:THREE.FrontSide,map:a.map})),16460!=o.data.flags&&(a.alphaTest=.05)}return a}};var y=n.getTexture=function(e,t,a){var n;return e&&a[e]?n=a[e]:e&&((n=r(t,e)).wrapT=THREE.RepeatWrapping,n.wrapS=THREE.RepeatWrapping,n.flipY=!1,a[e]=n),n},r=n.loadLocalTexture=function(e,t,a,n,i){void 0===n&&(n=Math.floor(16777215*Math.random()));var o=function(e,t,a){for(var n=e*t,r=new Uint8Array(4*n),i=Math.floor(255*a.r),o=Math.floor(255*a.g),s=Math.floor(255*a.b),l=0;l<n;l++){var d=4*l;r[d]=i,r[d+1]=o,r[d+2]=s,r[d+3]=255}return new THREE.DataTexture(r,e,t,THREE.RGBAFormat)}(1,1,new THREE.Color(n));return o.minFilter=THREE.LinearMipMapLinearFilter,o.magFilter=THREE.LinearFilter,o.generateMipmaps=!0,o.flipY=!0,parseInt(t)<=0?i&&i():e.loadTextureFile(t,function(e,t,a,n){if(e){var r={data:new Uint8Array(e),width:a,height:n};o.format=THREE.RGBAFormat,o.image=r,o.needsUpdate=!0}else i&&i()}),o}},{}],18:[function(e,t,a){var n=t.exports={};n.f16=function(e){var t=(32768&e)>>15,a=(31744&e)>>10,n=1023&e;return 0==a?(t?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):31==a?n?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,a-15)*(1+n/Math.pow(2,10))},n.popcount=function(e){var t=858993459,a=252645135;return e=((e=((e-=e>>1&1431655765)&t)+(e>>2&t))&a)+(e>>4&a),(e+=e>>8)+(e>>15)&63};var r=Math.pow(2,32);n.arr32To64=function(e){return r*e[1]+e[0]},n.sort_unique=function(e,t){for(var a=Array.prototype.sort.call(e,t),n={},r=[],i=0,o=a.length;i<o;++i)n.hasOwnProperty(a[i])||(r.push(a[i]),n[a[i]]=1);return r}},{}],19:[function(e,t,a){t.exports={getArrayReader:function(s,l){return function(e,t){var a=[];try{var n=e.readUint32(),r=e.readUint32();if(0==r)return a;var i=e.position-4+r,o=e.position;if(l&&l<n)throw"Array length "+n+" exceeded allowed maximum "+l;o=e.position;e.seek(i),a=e.readType(["[]",s,n],t),e.seek(o)}catch(e){console.warn("getArrayReader Failed loading array",e),console.warn("getArrayReader Failed loading array, structDef",s)}return a}},getRefArrayReader:function(f){return function(e,t){var a=[],n=e.readUint32(),r=e.position+e.readUint32();if(0==n)return a;var i=e.position;e.seek(r);var o=e.readInt32Array(n),s=i-4;e.seek(s),s+=e.readUint32();for(var l=0;l<o.length;l++)if(0!=o[l]){var d=s+4*l+o[l];e.seek(d);try{a.push(e.readStruct(f))}catch(e){a.push(null),console.warn("getRefArrayReader could not find refered data at offset",o[l],e)}}return e.seek(i),a}},getQWordReader:function(){return function(e,t){return e.readUint32()+"-"+e.readUint32()}},getStringReader:function(){return function(e,t){var a=e.position+e.readUint32(),n=e.position;e.seek(a);var r=e.readCString();return e.seek(n),r}},getString16Reader:function(o){return function(e,t){var a=e.position+e.readUint32()+(o||0),n=e.position;e.seek(a);for(var r,i="";e.position+2<e.byteLength&&0!=(r=e.readUint16());)i+=String.fromCharCode(r);return e.seek(n),i}},getPointerReader:function(o){return function(e,t){var a=e.readUint32();if(0==a)return{};var n=e.position-4+a,r=e.position;e.seek(n);var i=e.readStruct(o);return e.seek(r),i}},getFileNameReader:function(){return function(t,e){try{var a=t.position+t.readUint32(),n=t.position;t.seek(a);var r=t.readStruct(["m_lowPart","uint16","m_highPart","uint16","m_terminator","uint16"]),i=65280*(r.m_highPart-256)+(r.m_lowPart-256)+1;return i<0&&(i=0),t.seek(n),i}catch(e){return t.seek(n),-1}}}}},{}],20:[function(e,t,a){var p=e("../format/file/GW2File"),O=e("./MaterialUtils"),_=e("./MathUtils"),G={},W=1,B=2,z=4,Y=8,j=16,V=32,q=64,Z=128,K=65280,X=16711680,n=t.exports={},g=(n.renderRect=function(e,t,a,n){var r=e.x1-e.x2,i=e.y1-e.y2;n||(n=1);var o=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,l=t,d=new THREE.BoxGeometry(r,n,i);a=a||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});var f=new THREE.Mesh(d,a);return f.overdraw=!0,f.position.x=o,f.position.y=l,f.position.z=s,f},n.loadLocalTexture=function(e,t,a,n,r){return O.loadLocalTexture(e,t,a,n,r)},n.renderGeomChunk=function(C,e,L,P,H){var t=e.data.meshes,U=[],I=L.data.permutations[0].materials;return t.forEach(function(e){var t=e.geometry,a=t.verts.mesh.fvf,n=t.verts.vertexCount,r=t.verts.mesh.vertices,i=t.indices.indices,o=new THREE.BufferGeometry,s=new DataStream(r.buffer),l=r.length/n,d=new Float32Array(3*n),f=[],m=12*!!(a&W)+4*!!(a&B)+4*!!(a&z)+12*!!(a&Y)+4*!!(a&j)+12*!!(a&V)+12*!!(a&q)+12*!!(a&Z),u=(a&K)>>8,h=(a&X)>>16,c=!!u,p=!!h||!!u,g=c?u:h,v=_.popcount(g);if(v=Math.min(v,1),p)for(var y=0;y<v;y++)f[y]=new Float32Array(2*n);for(y=0;y<n;y++){s.seek(y*l);var E=s.readFloat32(),R=s.readFloat32(),T=s.readFloat32();if(d[3*y+0]=E,d[3*y+1]=-T,d[3*y+2]=-R,p)for(var N=0;N<v;N++){var x,M;s.seek(y*l+m+N*(c?8:4)),c?(x=s.readUint32(),M=s.readUint32()):(x=_.f16(s.readUint16()),M=_.f16(s.readUint16())),f[N][2*y+0]=x,f[N][2*y+1]=M}}var w=new Uint16Array(i.length);for(y=0;y<i.length;y+=3)w[y+0]=i[y+2],w[y+1]=i[y+1],w[y+2]=i[y+0];if(o.addAttribute("position",new THREE.BufferAttribute(d,3)),o.setIndex(new THREE.BufferAttribute(w,1)),o.computeVertexNormals(),p){for(N=0;N<v;N++){var F="uv"+(0<N?N+1:"");o.addAttribute(F,new THREE.BufferAttribute(f[N],2)),o.attributes[F].needsUpdate=!0}o.uvsNeedUpdate=!0}o.buffersNeedUpdate=!0;var D=e.materialIndex,k=I[D],b=null;k&&G[k.filename]&&(b=G[k.filename]);var A=O.getMaterial(k,b,C,P);if(!A){if(!H)return;A=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}var S=new THREE.Mesh(o,A);k&&(S.materialFlags=k.materialFlags,S.materialFilename=k.filename),S.materialName=e.materialName,S.numLods=e.geometry.lods.length,S.lodOverride=L.data.lodOverride,S.flags=e.flags,S.numUV=v,U.push(S)}),U}),s=n.loadMeshFromModelFile=function(d,e,f,m,u,h){var c=[];f.loadFile(d,function(e){try{if(!e)throw"Could not find MFT entry for "+d;var t=new DataStream(e),a=new p(t,0),n=a.getChunk("modl"),r=a.getChunk("geom"),i=n.data.boundingSphere,o=i.center;i.radius+=Math.sqrt(o[0]*o[0]+Math.sqrt(o[1]*o[1]+o[2]*o[2]));var s=n.data.permutations[0].materials;!function n(r,i){if(r>=s.length)i();else{var o=s[r];G[o.filename]?n(r+1,i):f.loadFile(o.filename,function(e){if(e){var t=new DataStream(e),a=new p(t,0);G[o.filename]=a}n(r+1,i)})}}(0,function(){g(f,r,n,m,u).forEach(function(e){[0,8,9,520,2056,2057,2060,2061,2312,2316,2568,2569,2572,2573,2584,2824,2828,2840,4617,6664].indexOf(e.materialFlags),e.materialFlags,(u||2056&e.materialFlags)&&(4==e.flags||1==e.flags||e.flags,c.push(e))}),h(c,i)})}catch(e){console.warn("Failed rendering model "+d,e);var l=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);l.flags=4,l.materialFlags=2056,l.lodOverride=[1e6,1e6],c.push(l),h(c)}})};n.getMeshesForFilename=function(a,e,t,n,r,i,o){n[a]?o(n[a].meshes,!0,n[a].boundingSphere):s(a,e,t,r,i,function(e,t){e&&(n[a]={meshes:e,boundingSphere:t}),o(e,!1,t)})},n.getFilesUsedByModel=function(a,e,n){var r=[a];e.loadFile(a,function(e){try{if(!e)throw"Could not find MFT entry for "+a;var t=new DataStream(e);new p(t,0).getChunk("modl").data.permutations[0].materials.forEach(function(e){var t=e.filename;r.push(t),e.textures.forEach(function(e){r.push(e.filename)})})}catch(e){console.warn("Could not export any data",e)}n(r)})}},{"../format/file/GW2File":16,"./MaterialUtils":17,"./MathUtils":18}],21:[function(e,t,a){t.exports={fragmentShader:["uniform vec2 uvScale;","uniform vec2 offset;","uniform sampler2D texturePicker;","uniform sampler2D texturePicker2;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","uniform sampler2D texture4;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 vecNormal;","vec3 blend(","vec4 texture1, float a1, vec4 texture2, float a2,","vec4 texture3, float a3, vec4 texture4, float a4)","{","float depth = 2.0;","float alphaMult = 1.0;","float alphaAdd  = 0.0;","a1 *= 4.0;","a2 *= 4.0;","a3 *= 4.0;","a4 *= 4.0;","a1 =  a1+(1.5+texture1.a);","a2 =  a2+(1.5+texture2.a);","a3 =  a3+(1.5+texture3.a);","a4 =  a4+(1.5+texture4.a);","float ma = max(a1,a2);","ma = max(ma,a3);","ma = max(ma,a4);","ma -= depth;","float b1 = max(a1 - ma, 0.0);","float b2 = max(a2 - ma, 0.0);","float b3 = max(a3 - ma, 0.0);","float b4 = max(a4 - ma, 0.0);","return (","texture1.rgb * b1 + texture2.rgb * b2 +","texture3.rgb * b3 + texture4.rgb * b4 ",") / (b1 + b2 + b3 + b4);","}","void main( void ) {","vec2 position = vUv*uvScale;","float edge = 1.0/1024.0;","vec2 compPos = edge + (vUv*0.25 + offset) * (1.0-edge*2.0);","vec4 tp1 = texture2D( texturePicker, compPos);","vec4 tp2 = texture2D( texturePicker2, compPos);","vec4 composite = tp1;","vec4 t1 = texture2D( texture1, position );","vec4 t2 = texture2D( texture2, position );","vec4 t3 = texture2D( texture3, position );","vec4 t4 = texture2D( texture4, position );","vec3 color = blend(","t1, tp1.a,","t2, tp1.b,","t3, tp1.g,","t4, tp1.r",");","color *= 0.5+tp2.r;","gl_FragColor = vec4(color,1.0);",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n"),vertexShader:["varying vec2 vUv;","varying vec3 vecNormal;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main()","{","vUv =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n")}},{}]},{},[4])(4)});