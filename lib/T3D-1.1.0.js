!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).T3D=e()}}(function(){return function(){return function e(a,t,r){function n(o,s){if(!t[o]){if(!a[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var f=t[o]={exports:{}};a[o][0].call(f.exports,function(e){var t=a[o][1][e];return n(t||e)},f,f.exports,e,a,t,r)}return t[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}}()({1:[function(e,a,t){const r=e("../util/MathUtils");function n(e){var a={};if(a.version=e.readUint8(),a.magic=e.readString(3),a.headerSize=e.readUint32(),e.seek(e.position+4),a.chunkSize=e.readUint32(),a.crc=e.readUint32(),e.seek(e.position+4),a.mftOffset=r.arr32To64([e.readUint32(),e.readUint32()]),a.mftSize=e.readUint32(),a.flags=e.readUint32(),"AN"==a.magic)return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header"),a;T3D.Logger.log(T3D.Logger.TYPE_ERROR,"ANDat header is not valid",a.magic)}function i(e){var a={};if(a.magic=e.readString(4),e.seek(e.position+8),a.nbOfEntries=e.readUint32(),e.seek(e.position+4+4),"Mft"!=a.magic)return void T3D.Logger.log(T3D.Logger.TYPE_ERROR,"MFTTable header is not valid",a.magic);let t=[];for(let n=1;n<a.nbOfEntries;n++){let a={};a.offset=r.arr32To64([e.readUint32(),e.readUint32()]),a.size=e.readUint32(),a.compressed=e.readUint16(),e.seek(e.position+4+2),a.crc=e.readUint32(),t[n]=a}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Loaded MFTTable"),{header:a,table:t,mftIndexOffset:t[2].offset,mftIndexSize:t[2].size}}function o(e,a){let t=a/8,r=[];for(let a=0;a<t;a++){let a=e.readUint32(),t=e.readUint32();r[a]=t}return T3D.Logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT"),r}function s(e,a,t){return new Promise((r,n)=>{let i=new FileReader;i.onerror=n,i.onload=function(e){var a=e.target.result,n=new DataStream(a);n.endianness=DataStream.LITTLE_ENDIAN,r({ds:n,len:t})},i.readAsArrayBuffer(e.slice(a,a+t))})}a.exports={readArchive:async function(e){let a=n((await s(e,0,40)).ds),t=i((await s(e,a.mftOffset,a.mftSize)).ds),{ds:r,len:l}=await s(e,t.mftIndexOffset,t.mftIndexSize),d=o(r,l);return{archiveHeader:a,metaTable:t.table,indexTable:d}},parseANDatHeader:n,parseMFTTable:i,parseMFTIndex:o,getFilePart:s}},{"../util/MathUtils":20}],2:[function(e,a,t){a.exports=class{constructor(e){this._settings=e,this._workerPool=[],this._workerLoad=[],this._inflateCallbacks=[];for(let a=0;a<e.workersNb;a++)this._startWorker(e.workerPath)}inflate(e,a,t,r,n){return new Promise((a,i)=>{let o=e.buffer;if((!n||n<0)&&(n=0),o.byteLength<12)return T3D.Logger.log(T3D.Logger.TYPE_WARNING,`not inflating, length is too short (${o.byteLength})`,t),void i(new Error("Couldn't inflate "+t+" (mftId)"));if(this._inflateCallbacks[t])return void this._inflateCallbacks[t].push({resolve:a,reject:i});this._inflateCallbacks[t]=[{resolve:a,reject:i}];let s=this._getBestWorkerIndex();this._workerLoad[s]+=1,this._workerPool[s].postMessage([t,o,!0===r,n])})}_startWorker(e){let a=this,t=new Worker(e),r=this._workerPool.push(t)-1;if(this._workerLoad.push(0)!=r+1)throw new Error("WorkerLoad and WorkerPool don't have the same length");t.onmessage=function(e){let t;if(a._workerLoad[r]-=1,"string"==typeof e.data){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Inflater threw an error",e.data),t=e.data.split(":")[0];for(let e of a._inflateCallbacks[t])e.reject()}else if(t=e.data[0],a._inflateCallbacks[t]){for(let r of a._inflateCallbacks[t]){let a=e.data;r.resolve({buffer:a[1],dxtType:a[2],imageWidth:a[3],imageHeight:a[4]})}a._inflateCallbacks[t]=null}else T3D.Logger.log(T3D.Logger.TYPE_ERROR,"Inflater threw an error",e.data)}}_getBestWorkerIndex(){return this._workerLoad.indexOf(Math.min(...this._workerLoad))}}},{}],3:[function(e,a,t){let r=e("../format/file/GW2File.js"),n={getFileType:function(e){let a=e.readCString(4);switch(a){case"ATEC":return"TEXTURE_ATEC";case"ATEP":return"TEXTURE_ATEP";case"ATET":return"TEXTURE_ATET";case"ATEU":return"TEXTURE_ATEU";case"ATEX":return"TEXTURE_ATEX";case"ATTX":return"TEXTURE_ATTX"}if(0===a.indexOf("DDS"))return"TEXTURE_DDS";if(1===a.indexOf("PNG"))return"TEXTURE_PNG";if(0===a.indexOf("RIFF"))return"TEXTURE_RIFF";if(0===a.indexOf("YUI"))return"TEXT_YUI";if(0===a.indexOf("PF")){return"PF_"+new r(e,0,!0).header.type}return 0===a.indexOf("MZ")?"BINARIES":0===a.indexOf("strs")?"STRINGS":0===a.indexOf("asnd")?"CHUNK_ASND":"UNKNOWN"}};a.exports=n},{"../format/file/GW2File.js":18}],4:[function(e,a,t){const r=e("./ArchiveParser"),n=e("./PersistantStore"),i=e("./DataReader"),o=e("../MapFileList"),s=e("./FileTypes");a.exports=class{constructor(e){this._settings=e,this._dataReader=new i(e),this._persistantStore,this._file=void 0,this._indexTable=[],this._fileMetaTable=[],!1!==e.noIndexedDB&&(this._persistantStore=new n)}async openArchive(e){let{archiveHeader:a,metaTable:t,indexTable:n}=await r.readArchive(e);this._fileMetaTable=t,this._indexTable=n,this._file=e}getFileIndex(e){return this._indexTable[e]}getFileMeta(e){return this._fileMetaTable[e]}async readFile(e,a,t,n,i){let o=this.getFileMeta(e);if(!o)throw new Error("Unexistant file");let{ds:s,len:l}=await r.getFilePart(this._file,o.offset,n||o.size);if(o.compressed||0!=t){let t;return await this._dataReader.inflate(s,l,e,a,i||0).then(e=>{t=e}).catch(e=>{t={buffer:void 0,dxtType:void 0,imageWidth:void 0,imageHeight:void 0}}),t}return{buffer:s.buffer}}async readFileList(e){let a,t=this,r=e||[];this._persistantStore&&(r=(await this._persistantStore.getLastListing(this._file.name)).array);let n=Object.keys(t._indexTable).map(e=>Number(e));for(let e in r)e in t._indexTable||n.push(e);let i=[];for(let e=0;e<1;e++)i[e]=Promise.resolve({task:e});let o=!1;for(let e in n){let s=n[e],l=this._needsScan(s,r);if(1==l.scan){let e=(await Promise.race(i)).task;i[e]=this._readFileType(s).then(a=>(r[s]={baseId:s,size:a.size,crc:a.crc,fileType:a.fileType},{task:e}))}"removed"==l.change&&delete r[s],"none"!==l.change&&(o=!0),e%Math.floor(n.length/100)==0&&(T3D.Logger.log(T3D.Logger.TYPE_PROGRESS,"Finding types",e/Math.floor(n.length/100)),t._persistantStore&&o&&(o=!1,t._persistantStore.putListing(a,r,t._file.name).then(e=>a=e)))}return await Promise.all(i),this._persistantData=r,this.getFileList()}getMapList(){let e=this,a=[];if(this._persistantData){let t=this.getReverseIndex(),r=this._persistantData.filter(e=>"PF_mapc"===e.fileType).filter(a=>a.baseId==t[e.getFileIndex(a.baseId)][0]);for(let e of r){let t=!1;for(let r of o.maps){let n=r.maps.find(a=>Number(a.fileName.split(".data")[0])==e.baseId);if(n){a.push({name:n.name,category:r.name,baseId:e.baseId}),t=!0;break}}t||a.push({name:e.baseId.toString(),category:"Uncategorized",baseId:e.baseId})}}else for(let e of o.maps)for(let t of e.maps)Number(t.fileName.split(".data")[0])in this._indexTable&&a.push({name:t.name,category:e.name,baseId:Number(t.fileName.split(".data")[0])});return a}getFileList(){let e=this._persistantData?this._persistantData.map(e=>e.fileType):[],a=this.getReverseIndex(),t=this._fileMetaTable.map((t,r)=>{let n=a[r]?a[r]:[],i=a[r]?e[n[0]]:"Non-Registered";return{mftId:r,baseIdList:n,size:t.size,crc:t.crc,fileType:i}});return t[0]={mftId:0,baseIdList:[],size:0,crc:0,fileType:"Non-Registered"},t}getReverseIndex(){return this._indexTable.reduce((e,a,t)=>(a in e?e[a].push(t):e[a]=[t],e),[])}readMapListAsync(e,a){let t=this;function r(e){let a=[];for(let t of e){let e=a.findIndex(e=>e.name==t.category);-1==e&&(e=a.push({name:t.category,maps:[]})-1),a[e].maps.push({fileName:t.baseId,name:t.name})}return a.sort((e,a)=>e.name<a.name?-1:e.name>a.name?1:0),{maps:a}}T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readMapListAsync is deprecated !"),e?this.readFileList().then(()=>{a(r(t.getMapList()))}):a(r(t.getMapList()))}readFileListAsync(e){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.readFileListAsync is deprecated !"),this.readFileList().then(a=>{let t={};for(let e of a)void 0===t[e.fileType]&&(t[e.fileType]=[]),t[e.fileType].push(e.mftId);e(t)})}loadFile(e,a,t,r){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFile is deprecated !");let n=this.getFileIndex(e);if(n<=0)return a(null);this.readFile(n,t,r).then(e=>{if(void 0==e.buffer)return a(null);a(e.buffer,e.dxtType,e.imageWidth,e.imageHeight)})}loadTextureFile(e,a){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadTextureFile is deprecated !"),this.loadFile(e,a,!0)}loadFileList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadFileList is deprecated !")}loadMapList(){T3D.Logger.log(T3D.Logger.TYPE_WARNING,"LocalReader.loadMapList is deprecated !")}_needsScan(e,a){if(e<=0)return{change:"none",scan:!1};let t=this.getFileIndex(e),r=this.getFileMeta(t);return void 0!==r||e in a?void 0===r?{change:"removed",scan:!1}:e in a?r.size!==a[e].size||r.crc!==a[e].crc?{change:"modified",scan:!0}:{change:"none",scan:!1}:{change:"added",scan:!0}:{change:"none",scan:!1}}async _readFileType(e){this._fileTypeCache||(this._fileTypeCache=[]);let a,t=this.getFileIndex(e),r=this.getFileMeta(t);if(void 0!=this._fileTypeCache[e])a=this._fileTypeCache[e];else{let e=(await this.readFile(t,!1,!1,Math.min(r.size,1e3),32)).buffer;if(void 0==e)return;a=s.getFileType(new DataStream(e))}return{fileType:a,crc:r.crc,size:r.size}}}},{"../MapFileList":7,"./ArchiveParser":1,"./DataReader":2,"./FileTypes":3,"./PersistantStore":5}],5:[function(e,a,t){e("../T3DLib").version;const r=3;a.exports=class{constructor(){this._dbConnection=void 0,this._getConnection(()=>{})}_getConnection(){let e=this;return new Promise((a,t)=>{e._dbConnection&&a(e._dbConnection);let n=window.indexedDB.open("Tyria3DLibrary",r);n.onblocked=(e=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database cannot be upgraded while the app is opened somewhere else.")}),n.onupgradeneeded=(e=>{let a=e.target.result,t=e.oldVersion;t<2&&a.createObjectStore("listings",{autoIncrement:!0}),t<3&&e.currentTarget.transaction.objectStore("listings").createIndex("filename","filename",{unique:!1})}),n.onsuccess=(t=>{e._dbConnection=t.target.result,e.isReady=!0,a(e._dbConnection)}),n.onerror=(e=>{T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database could not be opened."),t()})})}putListing(e,a,t){let r=this;return new Promise((n,i)=>{r._getConnection().then(r=>{let o=r.transaction(["listings"],"readwrite").objectStore("listings"),s=e?o.put({array:a,filename:t},e):o.put({array:a,name:t});s.onsuccess=(e=>{n(s.result)}),s.onerror=(e=>{i()})})})}getLastListing(e){let a=this;return new Promise((t,r)=>{a._getConnection().then(a=>{a.transaction(["listings"],"readonly").objectStore("listings").index("filename").openCursor(IDBKeyRange.only(e),"prev").onsuccess=(e=>{let a=e.target.result;t(a?{array:a.value.array,key:a.primaryKey}:{array:[],key:void 0})})})})}}},{"../T3DLib":8}],6:[function(e,a,t){var r={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};r.logFunctions=new Array(5),r.log=function(){if(0!=arguments.length){var e=r.argsToArr(arguments);1==e.length&&e.unshift(r.TYPE_MESSAGE);var a=Math.max(0,Math.min(r.logFunctions.length,e.shift()));r.logFunctions[a].apply(this,e)}},r.argsToArr=function(e){for(var a=new Array(e.length),t=0;t<a.length;++t)a[t]=e[t];return a},r.logFunctions[r.TYPE_ERROR]=function(){console.error.apply(console,arguments)},r.logFunctions[r.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},r.logFunctions[r.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},r.logFunctions[r.TYPE_PROGRESS]=function(){var e=r.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},r.logFunctions[r.TYPE_DEBUG]=function(){var e=r.argsToArr(arguments);console.debug.apply(console,e)},a.exports=r},{}],7:[function(e,a,t){a.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"1966018.data",name:"Hoelbrak (2)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"1968107.data",name:"Black Citadel (2)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"1968576.data",name:"Lion's Arch (4)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"1968748.data",name:"Divinity's Reach (3)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove (0)"},{fileName:"1969341.data",name:"The Grove (1)"},{fileName:"198272.data",name:"Rata Sum (0)"},{fileName:"1968896.data",name:"Rata Sum (1)"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"736241.data",name:"Edge of the Mists"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],8:[function(e,a,t){(function(t){var r=e("./LocalReader/LocalReader");function n(){}a.exports=n;var i,o={t3dtoolsWorker:"modules/t3dtools/t3dworker.js",concurrentTasks:"undefined"!=typeof navigator?navigator.hardwareConcurrency:1};n.version="1.1.0",n.GW2File=e("./format/file/GW2File"),n.GW2Chunk=e("./format/file/GW2Chunk"),n.DataRenderer=e("./dataRenderer/DataRenderer"),n.EnvironmentRenderer=e("./dataRenderer/EnvironmentRenderer"),n.HavokRenderer=e("./dataRenderer/HavokRenderer"),n.PropertiesRenderer=e("./dataRenderer/PropertiesRenderer"),n.SingleModelRenderer=e("./dataRenderer/SingleModelRenderer"),n.TerrainRenderer=e("./dataRenderer/TerrainRenderer"),n.ZoneRenderer=e("./dataRenderer/ZoneRenderer"),n.StringRenderer=e("./dataRenderer/StringRenderer"),n.Logger=e("./Logger"),n.MapFileList=e("./MapFileList"),n.MaterialUtils=e("./util/MaterialUtils.js"),n.MathUtils=e("./util/MathUtils.js"),n.ParserUtils=e("./util/ParserUtils.js"),n.RenderUtils=e("./util/RenderUtils.js"),n.PersistantStore=e("./LocalReader/PersistantStore"),n.FileTypes=e("./LocalReader/FileTypes"),n.getLocalReader=function(e,a,t){var n=new r({workerPath:t||o.t3dtoolsWorker,workersNb:o.concurrentTasks});return n.openArchive(e).then(()=>{a(n)}),n},n.getFileListAsync=function(e,a){var t=e.loadFileList();t?a(t):e.readFileListAsync(a)},n.getMapListAsync=function(e,a,t){if(t)e.readMapListAsync(!0,a);else{var r=e.loadMapList();r?a(r):e.readMapListAsync(!1,a)}},n.renderMapContentsAsync=function(e,a,t,r,i){var o={};parseInt(a)?e.loadFile(a,function(a){var i=new DataStream(a,0,DataStream.LITTLE_ENDIAN),s=new n.GW2File(i,0),l=function(a){a<t.length?n.runRenderer(t[a].renderClass,e,Object.assign(t[a].settings,{mapFile:s}),o,l.bind(this,a+1)):r(o)};l(0)}):(i||n.Logger).log(n.Logger.TYPE_ERROR,"Map id must be an integer!, was:",a)},n.runRenderer=function(e,a,t,r,n){new e(a,t,r).renderAsync(n)},n.getContextValue=function(e,a,t,r){var n=e[a.name];return n&&n[t]?n[t]:r},n.hasWebGL=function(e){if(window.WebGLRenderingContext){for(var a=document.createElement("canvas"),t=["webgl","experimental-webgl","moz-webgl","webkit-3d"],r=!1,n=0;n<4;n++)try{if((r=a.getContext(t[n]))&&"function"==typeof r.getParameter)return!e||{name:t[n],gl:r}}catch(e){}return!1}return!1},i=0,t.window&&window.indexedDB||(n.Logger.log(n.Logger.TYPE_ERROR,"T3D persistant storing and loading requires indexedDB support."),i++),"undefined"==typeof DataStream&&(n.Logger.log(n.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),i++),"undefined"==typeof THREE&&(n.Logger.log(n.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),i++),i<1&&n.Logger.log(n.Logger.TYPE_MESSAGE,"Tyria 3D API v"+n.version+" initialized.")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LocalReader/FileTypes":3,"./LocalReader/LocalReader":4,"./LocalReader/PersistantStore":5,"./Logger":6,"./MapFileList":7,"./dataRenderer/DataRenderer":9,"./dataRenderer/EnvironmentRenderer":10,"./dataRenderer/HavokRenderer":11,"./dataRenderer/PropertiesRenderer":12,"./dataRenderer/SingleModelRenderer":13,"./dataRenderer/StringRenderer":14,"./dataRenderer/TerrainRenderer":15,"./dataRenderer/ZoneRenderer":16,"./format/file/GW2Chunk":17,"./format/file/GW2File":18,"./util/MaterialUtils.js":19,"./util/MathUtils.js":20,"./util/ParserUtils.js":21,"./util/RenderUtils.js":22}],9:[function(e,a,t){var r=e("../format/file/GW2File"),n=a.exports=function(e,a,t,r){this.localReader=e,this.settings=a,a||(a={}),this.context=t,this.context[this.constructor.name]={},this.logger=r||T3D.Logger};n.prototype.getOutput=function(e){return this.context[e?e.name:this.constructor.name]},n.prototype.renderAsync=function(e){var a=this;this.localReader.loadFile(this.settings.id,function(t){a.getOutput().fileId=a.settings.id,a.getOutput().rawData=t;for(var n=new Uint8Array(t),i=[],o=Math.min(n.length,1e4),s=0;65535*s<o;s++)i.push(String.fromCharCode.apply(null,n.subarray(65535*s,65535*(s+1))));o<n.length&&i.push("T3D Ignored the last "+(n.length-o)+" bytes when generating this raw output"),a.getOutput().rawString=i.join();var l=new DataStream(t),d=l.readCString(4);"ATEX"==d||"ATEC"==d||"ATEP"==d||"ATET"==d||"ATEU"==d||"ATTX"==d?a.localReader.loadTextureFile(a.settings.id,function(t,r,n,i){var o={data:new Uint8Array(t),width:n,height:i};a.getOutput().image=o,e()}):0==d.indexOf("PF")?(a.getOutput().file=new r(l,0),e()):(a.getOutput().file=null,e())})}},{"../format/file/GW2File":18}],10:[function(e,a,t){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,a,t,i){n.call(this,e,a,t,i),this.mapFile=this.settings.mapFile,this.getMat=function(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})},this.loadTextureWithFallback=function(a,t,n,i,o){var s=this;function l(e){a.forEach(function(a){t[a]=e})}function d(){l(s.getMat((new THREE.TextureLoader).load(i)))}l(s.getMat(r.loadLocalTexture(e,n,null,o,function(){setTimeout(d,1)})))},this.getHazeColor=function(e){var a=e&&e.dataGlobal.haze;return!a||a.length<=0?[190,160,60]:a[0].farColor},this.parseLights=function(e){var a=this;a.getOutput().lights=[];var t,r=!1;(e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}]).forEach(function(e,n){if(!r){if(e.lights.forEach(function(e,t){r=!0;var n=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),i=new THREE.DirectionalLight(n.getHex(),e.intensity);i.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),e.intensity,a.getOutput().lights.push(i)}),!e.lights||0==e.lights.length){[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]].forEach(function(e){var t=new THREE.Color(1,1,1),r=e[3],n=new THREE.DirectionalLight(t.getHex(),r);n.position.set(e[0],e[1],e[2]).normalize(),r,a.getOutput().lights.push(n)})}e.backlightIntensity=e.backlightIntensity;var i=new THREE.Color(e.backlightIntensity*(255-e.backlightColor[2])/255,e.backlightIntensity*(255-e.backlightColor[1])/255,e.backlightIntensity*(255-e.backlightColor[0])/255);t=new THREE.AmbientLight(i)}});var n=0;t&&(n=t.color.r+t.color.g+t.color.b,this.getOutput().lights.push(t)),this.getOutput().hasLight=r||n>0},this.parseSkybox=function(e,a,t){this.getOutput().skyElements=[];var r=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];r||(r={texPathNE:1930687,texPathSW:193069,texPathT:193071});var n=a.rect,i=Math.abs(n.x1-n.x2),o=Math.abs(n.y1-n.y2),s=(Math.max(i,o),[]);this.loadTextureWithFallback([1,4],s,r.texPathNE+1,"img/193068.png",t),this.loadTextureWithFallback([0,5],s,r.texPathSW+1,"img/193070.png",t),this.loadTextureWithFallback([2],s,r.texPathT+1,"img/193072.png",t),s[3]=new THREE.MeshBasicMaterial({visible:!1});var l=new THREE.BoxGeometry(1024,512,1024);l.faceVertexUvs[0].forEach(function(e,a){var t=Math.floor(a/2);0==t||1==t?e.forEach(function(e){e.x=1-e.x,e.y/=2,e.y+=.5}):5==t||4==t?e.forEach(function(e){e.y/=-2,e.y+=.5}):e.forEach(function(e){e.x=1-e.x})}),l.uvsNeedUpdate=!0;var d=new THREE.Mesh(l,s);d.translateY(256),this.getOutput().skyElements.push(d)}}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var a=this.mapFile.getChunk("env").data,t=this.mapFile.getChunk("parm").data,r=this.getHazeColor(a),n=256*r[2]*256+256*r[1]+r[0];this.getOutput().hazeColor=r,this.parseLights(a),this.parseSkybox(a,t,n),e()},a.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],11:[function(e,a,t){var r=e("./DataRenderer");function n(e,a,t,n){r.call(this,e,a,t,n),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[],this.renderModels=function(e,a,t){var r;r=this.settings&&this.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),this.parseAllModels(e,r,a,200,0,t)},this.getCollisionsForAnimation=function(e,a){for(var t=[],r=0;r<e.collisionIndices.length;r++){var n=e.collisionIndices[r],i=a[n];i.index=n,t.push(i)}return t},this.parseAllModels=function(e,a,t,r,n,i){for(var o=n;o<n+r&&o<e.length;o++){var s=Math.round(100*o/e.length);s!=this.lastP&&(this.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+t+")",s),this.lastP=s);for(var l=this.animationFromGeomIndex(e[o].geometryIndex,this.geometries,this.animations),d=this.getCollisionsForAnimation(l,this.havokChunkData.collisions),f=0;f<d.length;f++){var m=d[f];this.renderMesh(m,e[o],a)}}o<e.length?window.setTimeout(this.parseAllModels.bind(this,e,a,t,r,n+r,i),10):i()},this.animationFromGeomIndex=function(e,a,t){var r=a[e].animations.length;return t[a[e].animations[r-1]]},this.renderMesh=function(e,a,t){var r=a.translate,n=a.rotate,i=32*a.scale,o=this.parseHavokMesh(e,t);o.position.set(r[0],-r[2],-r[1]),i&&o.scale.set(i,i,i),n&&(o.rotation.order="ZXY",o.rotation.set(n[0],-n[2],-n[1])),this.getOutput().meshes.push(o)},this.seedRandom=function(){var e=1e4*Math.sin(this.seed++);return e-Math.floor(e)},this.parseHavokMesh=function(e,a){var t=e.index;if(this.meshes[t])return this.meshes[t].clone();for(var r=new THREE.Geometry,n=0;n<e.vertices.length;n++){var i=e.vertices[n];r.vertices.push(new THREE.Vector3(i[0],i[2],-i[1]))}for(n=0;n<e.indices.length;n+=3){var o=e.indices[n],s=e.indices[n+1],l=e.indices[n+2];o<=e.vertices.length&&s<=e.vertices.length&&l<=e.vertices.length?r.faces.push(new THREE.Face3(o,s,l)):this.logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return r.computeFaceNormals(),this.meshes[t]=new THREE.Mesh(r,a),this.meshes[t]}}n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.renderAsync=function(e){var a=this;this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[],this.getOutput().meshes=[];var t=this.havokChunkData.propModels,r=this.havokChunkData.zoneModels,n=this.havokChunkData.obsModels;n.forEach(function(e){e.scale=1}),this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;var i=function(){a.renderModels(n,"obs",e)};a.renderModels(t,"prop",function(){a.renderModels(r,"zone",i)})},a.exports=n},{"./DataRenderer":9}],12:[function(e,a,t){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,a,t,r){n.call(this,e,a,t,r),this.mapFile=this.settings.mapFile}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var a=this;a.getOutput().meshes=[];var t=this.mapFile.getChunk("prp2").data;if(t){var n=t.propArray,i=t.propAnimArray,o=t.propInstanceArray,s=t.propMetaArray;n=n.concat(i).concat(o).concat(s),a.meshCache={},a.textureCache={};var l=-1,d=function(t){if(t>=n.length)return a.meshCache={},a.textureCache={},void e();var i=Math.round(1e3*t/n.length);if(l!=(i/=10)){var o=i+(i.toString().indexOf(".")<0?".0":"");a.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",o),l=i}var s=n[t],f=function(e,a,t,r,n){var i=0!=r.lod2?r.lod2:e.lodOverride[1];if(0==e.flags&&(i=0),n&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,a[i])a[i].add(e);else{var o=new THREE.Group;o.updateMatrix(),o.matrixAutoUpdate=!1,o.add(e),a[i]=o,t.addLevel(o,i)}return i};r.getMeshesForFilename(s.filename,s.color,a.localReader,a.meshCache,a.textureCache,!1,function(e,r,n){e&&function(e,t,r){var n={},i=new THREE.LOD,o=0;e.forEach(function(e){o=Math.max(o,f(e,n,i,s,t))}),i.addLevel(new THREE.Group,1e5),s.rotation&&(i.rotation.order="ZXY",i.rotation.set(s.rotation[0],-s.rotation[2],-s.rotation[1])),i.scale.set(s.scale,s.scale,s.scale),i.position.set(s.position[0],-s.position[2],-s.position[1]),i.boundingSphereRadius=(r&&r.radius?r.radius:1)*s.scale,i.updateMatrix(),i.matrixAutoUpdate=!1,a.getOutput().meshes.push(i),s.transforms&&s.transforms.forEach(function(t){var n={},i=new THREE.LOD,o=0;e.forEach(function(e){o=Math.max(o,f(e,n,i,s,!0))}),t.rotation&&(i.rotation.order="ZXY",i.rotation.set(t.rotation[0],-t.rotation[2],-t.rotation[1])),i.scale.set(t.scale,t.scale,t.scale),i.position.set(t.position[0],-t.position[2],-t.position[1]),i.updateMatrix(),i.matrixAutoUpdate=!1,i.boundingSphereRadius=(r&&r.radius?r.radius:1)*s.scale,i.update(i),a.getOutput().meshes.push(i)})}(e,r,n),d(t+1)})};d(0)}else renderCallback()},i.prototype.getFileIdsAsync=function(e){var a=[],t=this.mapFile.getChunk("prp2").data,r=t.propArray,n=t.propAnimArray,i=t.propInstanceArray,o=t.propMetaArray;r=r.concat(n).concat(i).concat(o);var s=function(t){if(t>=r.length)e(a);else{t%100==0&&this.logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",t,"of",r.length);var n=r[t];Utils.getFilesUsedByModel(n.filename,localReader,function(e){a=a.concat(e),s(t+1)})}};s(0)},a.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],13:[function(e,a,t){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,a,t,r){n.call(this,e,a,t,r)}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var a=this,t=this.settings.id,n={};a.getOutput().meshes=[],r.getMeshesForFilename(t,65280,a.localReader,n,{},!0,function(t,r,i){t&&t.forEach(function(e){e.boundingSphere=i,a.getOutput().meshes.push(e)}),n={},e()})},a.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],14:[function(e,a,t){var r=e("./DataRenderer");function n(e,a,t,n){r.call(this,e,a,t,n)}n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.renderAsync=function(e){var a=this;this.settings.id;this.getOutput().strings=[],this.localReader.loadFile(this.settings.id,function(t){var r=new DataStream(t),n=r.byteLength-2;r.seek(4);for(var i=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],o=0;n-r.position>6;){var s=r.readStruct(i);if(s.size-=6,s.size>0)if(!(0!=s.decryptionOffset||16!=s.bitsPerSymbol)){var l=r.readUCS2String(s.size/2);a.getOutput().strings.push({value:l,recid:o})}o++}r.seek(r.byteLength-2),a.getOutput().language=r.readUint16(),e()})},a.exports=n},{"./DataRenderer":9}],15:[function(e,a,t){var r=e("../util/RenderUtils"),n=e("./DataRenderer"),i=e("../format/file/GW2File.js"),o=e("../util/TerrainShader.js");function s(e,a,t,s,l){n.call(this,e,a,t,s,l),this.mapFile=this.settings.mapFile,this.drawWater=function(e){var a=a||new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35});return a.transparent=!0,r.renderRect(e,0,a)},this.parseNumChunks=function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1},this.loadPagedImageCallback=function(e,a){var t=this;t.getOutput().terrainTiles=[];var n=new DataStream(a),s=new i(n,0).getChunk("pgtb"),l=s&&s.data;this.mapRect=null;var d=this.mapFile.getChunk("trn").data,f=this.mapFile.getChunk("parm").data,m=this.settings.anisotropy?this.settings.anisotropy:1;this.parseNumChunks(d);var u=d.numChunksD_1,h=d.numChunksD_2,c=d.materials.materials,g=d.materials.texFileArray,p=f.rect[2]-f.rect[0],v=f.rect[3]-f.rect[1],T=p/d.numChunksD_1*1,E=v/d.numChunksD_2*1,y=0,R=[],N=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,flatShading:!0}),x={};l&&l.strippedPages.forEach(function(e){if(e.layer<=1){var a=e.filename,n=(e.solidColor,e.coord),i=n[0]+","+n[1];if(1==e.layer&&(i+="-2"),!x[i]){var o=r.loadLocalTexture(t.localReader,a);o&&(o.anisotropy=m,o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping),x[i]=o}}});var b=function(a,n){if(a>=u&&(a=0,n++),n>=h)return t.getOutput().water=t.drawWater(t.mapRect),t.getOutput().bounds=t.mapRect,void e();var i=Math.floor(100*(n*u+a)/(u*h));t.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",i),function(e,a){for(var n,i=a*u+e,s=Math.floor(e/4),l=Math.floor(a/4),h=c[i].loResMaterial.texIndexArray,p=(c[i].loResMaterial.materialFile,d.chunkArray[i],g[h[0]],e%4/4),v=.75-a%4/4,b=[],M=0;M<h.length/2;M++){var w=g[h[M]].filename;if(b.push(w),!x[w]){var k=r.loadLocalTexture(t.localReader,w);k&&(k.anisotropy=m,k.wrapS=THREE.RepeatWrapping,k.wrapT=THREE.RepeatWrapping),x[w]=k}}var F=s+","+l,D=s+","+l+"-2",L={color:{r:1,g:1,b:1},near:0,far:0},S=t.getOutput(T3D.EnvironmentRenderer);S.hazeColor&&(L.color.r=S.hazeColor[2]/255,L.color.g=S.hazeColor[1]/255,L.color.b=S.hazeColor[0]/255);var A=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);A.uvScale={type:"v2",value:new THREE.Vector2(8,8)},A.offset={type:"v2",value:new THREE.Vector2(p,v)},A.texturePicker={type:"t",value:x[F]},A.texturePicker2={type:"t",value:x[D]},A.texture1={type:"t",value:x[b[0]]},A.texture2={type:"t",value:x[b[1]]},A.texture3={type:"t",value:x[b[2]]},A.texture4={type:"t",value:x[b[3]]},n=new THREE.ShaderMaterial({uniforms:A,fragmentShader:o.getFragmentShader(),vertexShader:o.getVertexShader()}),R.push(n);for(var C=new THREE.PlaneBufferGeometry(T,E,32,32),P=0,_=0;_<35;_++)for(var H=0;H<35;H++)0!=H&&34!=H&&0!=_&&34!=_&&(C.getAttribute("position").array[3*P+2]=d.heightMapArray[y],P++),y++;var U,I=(new THREE.Matrix4).identity();I.elements[5]=-1,C.applyMatrix(I),C.computeFaceNormals(),U=new THREE.Mesh(C,N),(U=n.length?THREE.SceneUtils.createMultiMaterialObject(C,n):new THREE.Mesh(C,n)).rotation.set(Math.PI/2,0,0);var O=f.rect[0]+T/2,W=e*T;if(U.position.x=O+W,d.numChunksD_2%2==0){var G=f.rect[1]+E/2-0,B=a*E*1;U.position.z=B+G}else G=f.rect[1]-E/2+0,B=a*E*1,U.position.z=G+B;var z=U.position.x,Y=U.position.z;t.mapRect||(t.mapRect={x1:z-T/2,x2:z+T/2,y1:Y-E/2,y2:Y+E/2}),t.mapRect.x1=Math.min(t.mapRect.x1,z-T/2),t.mapRect.x2=Math.max(t.mapRect.x2,z+T/2),t.mapRect.y1=Math.min(t.mapRect.y1,Y-E/2),t.mapRect.y2=Math.max(t.mapRect.y2,Y+E/2),U.updateMatrix(),U.updateMatrixWorld(),t.getOutput().terrainTiles.push(U)}(a,n),setTimeout(b,1,a+1,n)};b(0,0)}}s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.renderAsync=function(e){var a=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.loadFile(a,this.loadPagedImageCallback.bind(this,e))},s.prototype.getFileIdsAsync=function(e){var a=this.mapFile.getChunk("trn"),t=this.mapFile.getChunk("pimg"),r=[];return(t&&t.data).strippedPages.forEach(function(e){e.layer<=1&&e.filename>0&&r.push(e.filename)}),a.data.materials.texFileArray.forEach(function(e){e.filename>0&&r.push(e.filename)}),r},a.exports=s},{"../format/file/GW2File.js":18,"../util/RenderUtils":22,"../util/TerrainShader.js":23,"./DataRenderer":9}],16:[function(e,a,t){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,a,t,i){n.call(this,e,a,t,i),this.mapFile=this.settings.mapFile,this.renderZone=function(e,a,t,n){var i=this,o=null;a.forEach(function(a){o||a.token!=e.defToken||(o=a)});var s=this.getModelGroups(e,o,t);i.meshCache={},i.textureCache={};var l=Object.keys(s);!function e(a){if(a>=l.length)return i.meshCache={},i.textureCache={},void n();var t=l[a],o=s[t],d=[];r.getMeshesForFilename(t,null,i.localReader,i.meshCache,i.textureCache,!1,function(t,r){t&&o.forEach(function(e,a){t.forEach(function(t,r){if(525!=t.materialFlags){var n={x:0,y:0,z:0};if(d[r])n.x=e.x-d[r].position.x,n.y=e.z-d[r].position.z,n.z=e.y-d[r].position.y;else{var i=t.geometry.clone();d[r]={readVerts:i.getAttribute("position").array,verts:new Float32Array(o.length*i.getAttribute("position").array.length),readIndices:i.getIndex().array,indices:new Uint32Array(o.length*i.getIndex().array.length),readUVs:i.getAttribute("uv").array,uvs:new Float32Array(o.length*i.getAttribute("uv").array.length),readNormals:i.getAttribute("normal").array,normals:new Float32Array(o.length*i.getAttribute("normal").array.length),material:t.material,position:{x:e.x,y:e.y,z:e.z}}}for(var s=d[r].readVerts,l=d[r].verts,f=s.length,m=0,u=a*f;m<f;m+=3,u+=3)l[u+0]=s[m+0]+n.x,l[u+1]=s[m+1]+n.y,l[u+2]=s[m+2]+n.z;var h=d[r].readIndices,c=d[r].indices,g=h.length,p=f*a/3;for(m=0,u=a*g;m<g;m++,u++)c[u]=h[m]+p;var v=d[r].readUVs,T=d[r].uvs,E=v.length;for(m=0,u=a*E;m<E;m++,u++)T[u]=v[m];var y=d[r].readNormals,R=d[r].normals,N=y.length;for(m=0,u=a*N;m<N;m++,u++)R[u]=y[m]}})}),d.forEach(function(e){var a=new THREE.BufferGeometry;a.addAttribute("position",new THREE.BufferAttribute(e.verts,3)),a.setIndex(new THREE.BufferAttribute(e.indices,1)),a.addAttribute("normal",new THREE.BufferAttribute(e.normals,3)),a.addAttribute("uv",new THREE.BufferAttribute(e.uvs,2)),a.buffersNeedUpdate=!0,mesh=new THREE.Mesh(a,e.material),mesh.position.set(e.position.x,e.position.z,e.position.y),i.getOutput().meshes.push(mesh)}),e(a+1)})}(0)},this.getModelGroups=function(e,a,t){e.zPos;var r=t[0],n=t[1],i=48,o=e.vertRect[0]*i+r,s=(e.vertRect[2],e.vertRect[1]*-i-n);e.vertRect[3];if(0==e.encodeData.length)return{};for(var l=e.vertRect[0]-e.vertRect[2],d=(e.vertRect[1],e.vertRect[3],0),f={},m=this.getOutput(T3D.TerrainRenderer).terrainTiles,u=0;u<e.flags.length;u+=2){d+=e.flags[u];var h=e.flags[u+1];if(0!=h){var c=h>>4,g=a.layerDefArray[c-1];if(g){var p=d%l*i+o,v=Math.floor(d/l)*i+s,T=null,E=new THREE.Raycaster(new THREE.Vector3(p,1e5,v),new THREE.Vector3(0,-1,0));m.forEach(function(e){if(null===T){var a=E.intersectObject(e);a.length>0&&(T=1e5-a[0].distance)}});var y=g.modelArray[0],R=y.filename,N=(y.zOffsets,g.layerFlags,g.rotRangeX),x=g.rotRangeY,b=g.rotRangeZ,M=g.scaleRange,w=g.fadeRange;f[R]||(f[R]=[]),f[R].push({x:p,y:v,z:T,rotRangeX:N,rotRangeY:x,rotRangeZ:b,scaleRange:M,fadeRange:w})}}}return f}}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var a=this;a.getOutput().meshes=[];var t=this.mapFile.getChunk("zon2").data,r=this.mapFile.getChunk("parm").data,n=(this.mapFile.getChunk("trn").data,r.rect),i=t.zoneArray,o=t.zoneDefArray;lastPct=-1,function t(r){var s=Math.round(100*r/i.length);lastPct!=s&&(a.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",s),lastPct=s),r>=i.length?e():a.renderZone(i[r],o,n,t.bind(a,r+1))}(0)},a.exports=i},{"../util/RenderUtils":22,"./DataRenderer":9}],17:[function(e,a,t){var r=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"],n={ANIM:["MODL","Unknown"],GAME:["MODL","Unknown"],Main:["cntc","mMet"],SKEL:["MODL","Unknown"],TOOL:["AMAT","MODL"],main:["Unknown","Unknown","cmaC"],nvms:["Unknown","Unknown"]},i=function(e,a){this.ds=e,this.addr=a,this.data=null,this.headerLength=NaN,this.loadHead()};i.prototype.loadHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(r),this.headerLength=this.ds.position-this.addr},i.prototype.getDefinition=function(e){var a=0,t=n[this.header.type];if(t){a=-1;for(var r=0;r<t.length&&-1==a;r++){t[r]==e&&(a=r)}}var i=0;for(r=0;r<T3D.formats.length;r++){var o=T3D.formats[r];if(o.name==this.header.type){if(i==a&&o.versions[this.header.chunkVersion])return(new o.versions[this.header.chunkVersion]).__root;i++}}},i.prototype.loadData=function(e){var a=this.getDefinition(e);a?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(a)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)},i.prototype.next=function(){try{return new i(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null},a.exports=i},{}],18:[function(e,a,t){var r=e("./GW2Chunk"),n=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"],i=function(e,a,t){this.ds=e,this.addr=a,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),t||this.readChunks()};i.prototype.readHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr},i.prototype.readChunks=function(){this.chunks=[];for(var e=new r(this.ds,this.headerLength+this.addr);null!=e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()},i.prototype.getChunk=function(e){for(var a=0;a<this.chunks.length;a++)if(this.chunks[a].header.type.toLowerCase()==e.toLowerCase())return this.chunks[a];return null},i.prototype.getChunkStructs=function(){return{}},a.exports=i},{"./GW2Chunk":17}],19:[function(e,a,t){var r=a.exports={};r.getMaterial=function(e,a,t,r){if(a){var i,o=a.getChunk("dx9s"),s=a.getChunk("grmt"),l=[];if(e&&e.textures.length){for(var d=o.data.techniques[0].passes[0].effects[0],f=(o.data.shaders[d.pixelShader],[]),m=0;m<d.samplerIndex.length;m++){var u=d.samplerIndex[m],h=o.data.samplers[u];if(h){var c=h&&s.data.texTokens[h.textureIndex];c||(c="0-0");var g=null;if(e.textures.forEach(function(e,a){g||e.token.split("-")[0]!=c.split("-")[0]||(g=e)}),g)f.push(g);else if(h)f.push(e.textures[h.textureIndex]);else{if(!(e.textures.length>0))return;f.push(e.textures[0])}}}if(f.length<=0)return;f.forEach(function(e,a){if(e){var i=e&&e.filename;l[a]=n(i,t,r),l[a]&&(l[a].uvIdx=e.uvPSInputIndex)}})}if(l){var p=!1,v=!1;if(e.textures.forEach(function(e){p||"1733499172"!=e.token.split("-")[0]||(p=e),v||"404146670"!=e.token.split("-")[0]||(v=e)}),!p||p.filename<=0)return;if(i=new THREE.MeshPhongMaterial({side:THREE.FrontSide,map:n(p.filename,t,r)}),v){var T=n(v.filename,t,r);T.flipY=!0,i.normalMap=T}i.textureFilename=p.filename,16460!=s.data.flags&&(i.alphaTest=.05)}else i=new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:16711680,shading:THREE.FlatShading});if(i.needsUpdate=!0,e){s=a.getChunk("grmt");1&e.materialFlags||16&e.materialFlags||e.materialFlags;[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(s.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",s.data.flags),8&s.data.flags||(i=new THREE.MeshBasicMaterial({side:THREE.FrontSide,map:i.map})),16460!=s.data.flags&&(i.alphaTest=.05)}return i}};var n=r.getTexture=function(e,a,t){var r;return e&&t[e]?r=t[e]:e&&((r=i(a,e)).wrapT=THREE.RepeatWrapping,r.wrapS=THREE.RepeatWrapping,r.flipY=!1,t[e]=r),r},i=r.loadLocalTexture=function(e,a,t,r,n){void 0===r&&(r=Math.floor(16777215*Math.random()));var i=function(e,a,t){for(var r=e*a,n=new Uint8Array(4*r),i=Math.floor(255*t.r),o=Math.floor(255*t.g),s=Math.floor(255*t.b),l=0;l<r;l++){var d=4*l;n[d]=i,n[d+1]=o,n[d+2]=s,n[d+3]=255}return new THREE.DataTexture(n,e,a,THREE.RGBAFormat)}(1,1,new THREE.Color(r));return i.minFilter=THREE.LinearMipMapLinearFilter,i.magFilter=THREE.LinearFilter,i.generateMipmaps=!0,i.flipY=!0,parseInt(a)<=0?(n&&n(),i):(e.loadTextureFile(a,function(e,a,t,r){if(e){var o={data:new Uint8Array(e),width:t,height:r};i.format=THREE.RGBAFormat,i.image=o,i.needsUpdate=!0}else n&&n()}),i)}},{}],20:[function(e,a,t){var r=a.exports={};r.f16=function(e){var a=(32768&e)>>15,t=(31744&e)>>10,r=1023&e;return 0==t?(a?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==t?r?NaN:1/0*(a?-1:1):(a?-1:1)*Math.pow(2,t-15)*(1+r/Math.pow(2,10))},r.popcount=function(e){return e=(252645135&(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459)))+(e>>4&252645135),(e+=e>>8)+(e>>15)&63};var n=Math.pow(2,32);r.arr32To64=function(e){return n*e[1]+e[0]},r.sort_unique=function(e,a){for(var t=Array.prototype.sort.call(e,a),r={},n=[],i=0,o=t.length;i<o;++i)r.hasOwnProperty(t[i])||(n.push(t[i]),r[t[i]]=1);return n}},{}],21:[function(e,a,t){a.exports={getArrayReader:function(e,a){return function(t,r){var n=[];try{var i=t.readUint32(),o=t.readUint32();if(0==o)return n;var s=t.position-4+o,l=t.position;if(a&&i>a)throw"Array length "+i+" exceeded allowed maximum "+a;l=t.position;t.seek(s),n=t.readType(["[]",e,i],r),t.seek(l)}catch(a){console.warn("getArrayReader Failed loading array",a),console.warn("getArrayReader Failed loading array, structDef",e)}return n}},getRefArrayReader:function(e){return function(a,t){var r=[],n=a.readUint32(),i=a.position+a.readUint32();if(0==n)return r;var o=a.position;a.seek(i);var s=a.readInt32Array(n),l=o-4;a.seek(l),l+=a.readUint32();for(var d=0;d<s.length;d++)if(0!=s[d]){var f=l+4*d+s[d];a.seek(f);try{r.push(a.readStruct(e))}catch(e){r.push(null),console.warn("getRefArrayReader could not find refered data at offset",s[d],e)}}return a.seek(o),r}},getQWordReader:function(){return function(e,a){return e.readUint32()+"-"+e.readUint32()}},getStringReader:function(){return function(e,a){var t=e.position+e.readUint32(),r=e.position;e.seek(t);var n=e.readCString();return e.seek(r),n}},getString16Reader:function(e){return function(a,t){var r=a.position+a.readUint32()+(e||0),n=a.position;a.seek(r);for(var i,o="";a.position+2<a.byteLength&&0!=(i=a.readUint16());)o+=String.fromCharCode(i);return a.seek(n),o}},getPointerReader:function(e){return function(a,t){var r=a.readUint32();if(0==r)return{};var n=a.position-4+r,i=a.position;a.seek(n);var o=a.readStruct(e);return a.seek(i),o}},getFileNameReader:function(){return function(e,a){try{var t=e.position+e.readUint32(),r=e.position;e.seek(t);var n=e.readStruct(["m_lowPart","uint16","m_highPart","uint16","m_terminator","uint16"]),i=65280*(n.m_highPart-256)+(n.m_lowPart-256)+1;return i<0&&(i=0),e.seek(r),i}catch(a){return e.seek(r),-1}}}}},{}],22:[function(e,a,t){var r=e("../format/file/GW2File"),n=e("./MaterialUtils"),i=e("./MathUtils"),o={},s=1,l=2,d=4,f=8,m=16,u=32,h=64,c=128,g=65280,p=16711680,v=a.exports={},T=(v.renderRect=function(e,a,t,r){var n=e.x1-e.x2,i=e.y1-e.y2;r||(r=1);var o=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,l=a,d=new THREE.BoxGeometry(n,r,i);t=t||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});var f=new THREE.Mesh(d,t);return f.overdraw=!0,f.position.x=o,f.position.y=l,f.position.z=s,f},v.loadLocalTexture=function(e,a,t,r,i){return n.loadLocalTexture(e,a,t,r,i)},v.renderGeomChunk=function(e,a,t,r,v){var T=a.data.meshes,E=[],y=t.data.permutations[0].materials;return T.forEach(function(a){var T=a.geometry,R=T.verts.mesh.fvf,N=T.verts.vertexCount,x=T.verts.mesh.vertices,b=T.indices.indices,M=new THREE.BufferGeometry,w=new DataStream(x.buffer),k=x.length/N,F=new Float32Array(3*N),D=[],L=12*!!(R&s)+4*!!(R&l)+4*!!(R&d)+12*!!(R&f)+4*!!(R&m)+12*!!(R&u)+12*!!(R&h)+12*!!(R&c),S=(R&g)>>8,A=(R&p)>>16,C=!!S,P=!!A||!!S,_=C?S:A,H=i.popcount(_);if(H=Math.min(H,1),P)for(var U=0;U<H;U++)D[U]=new Float32Array(2*N);for(U=0;U<N;U++){w.seek(U*k);var I=w.readFloat32(),O=w.readFloat32(),W=w.readFloat32();if(F[3*U+0]=I,F[3*U+1]=-W,F[3*U+2]=-O,P)for(var G=0;G<H;G++){var B,z;w.seek(U*k+L+G*(C?8:4)),C?(B=w.readUint32(),z=w.readUint32()):(B=i.f16(w.readUint16()),z=i.f16(w.readUint16())),D[G][2*U+0]=B,D[G][2*U+1]=z}}var Y=new Uint16Array(b.length);for(U=0;U<b.length;U+=3)Y[U+0]=b[U+2],Y[U+1]=b[U+1],Y[U+2]=b[U+0];if(M.addAttribute("position",new THREE.BufferAttribute(F,3)),M.setIndex(new THREE.BufferAttribute(Y,1)),M.computeVertexNormals(),P){for(G=0;G<H;G++){var j="uv"+(G>0?G+1:"");M.addAttribute(j,new THREE.BufferAttribute(D[G],2)),M.attributes[j].needsUpdate=!0}M.uvsNeedUpdate=!0}M.buffersNeedUpdate=!0;var V=a.materialIndex,X=y[V],q=null;X&&o[X.filename]&&(q=o[X.filename]);var K=n.getMaterial(X,q,e,r);if(!K){if(!v)return;K=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}var Z=new THREE.Mesh(M,K);X&&(Z.materialFlags=X.materialFlags,Z.materialFilename=X.filename),Z.materialName=a.materialName,Z.numLods=a.geometry.lods.length,Z.lodOverride=t.data.lodOverride,Z.flags=a.flags,Z.numUV=H,E.push(Z)}),E}),E=v.loadMeshFromModelFile=function(e,a,t,n,i,s){var l=[];t.loadFile(e,function(a){try{if(!a)throw"Could not find MFT entry for "+e;var d=new DataStream(a),f=new r(d,0),m=f.getChunk("modl"),u=f.getChunk("geom"),h=m.data.boundingSphere,c=h.center;h.radius+=Math.sqrt(c[0]*c[0]+Math.sqrt(c[1]*c[1]+c[2]*c[2]));var g=m.data.permutations[0].materials;!function e(a,n){if(a>=g.length)n();else{var i=g[a];o[i.filename]?e(a+1,n):t.loadFile(i.filename,function(t){if(t){var s=new DataStream(t),l=new r(s,0);o[i.filename]=l}e(a+1,n)})}}(0,function(){T(t,u,m,n,i).forEach(function(e){[0,8,9,520,2056,2057,2060,2061,2312,2316,2568,2569,2572,2573,2584,2824,2828,2840,4617,6664].indexOf(e.materialFlags),e.materialFlags,(i||2056&e.materialFlags)&&(4==e.flags||1==e.flags||e.flags,l.push(e))}),s(l,h)})}catch(a){console.warn("Failed rendering model "+e,a);var p=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);p.flags=4,p.materialFlags=2056,p.lodOverride=[1e6,1e6],l.push(p),s(l)}})};v.getMeshesForFilename=function(e,a,t,r,n,i,o){r[e]?o(r[e].meshes,!0,r[e].boundingSphere):E(e,a,t,n,i,function(a,t){a&&(r[e]={meshes:a,boundingSphere:t}),o(a,!1,t)})},v.getFilesUsedByModel=function(e,a,t){var n=[e];a.loadFile(e,function(a){try{if(!a)throw"Could not find MFT entry for "+e;var i=new DataStream(a);new r(i,0).getChunk("modl").data.permutations[0].materials.forEach(function(e){var a=e.filename;n.push(a),e.textures.forEach(function(e){n.push(e.filename)})})}catch(e){console.warn("Could not export any data",e)}t(n)})}},{"../format/file/GW2File":18,"./MaterialUtils":19,"./MathUtils":20}],23:[function(e,a,t){a.exports={getFragmentShader:function(){return["uniform vec2 uvScale;","uniform vec2 offset;","uniform sampler2D texturePicker;","uniform sampler2D texturePicker2;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","uniform sampler2D texture4;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 vecNormal;","vec3 blend(","vec4 texture1, float a1, vec4 texture2, float a2,","vec4 texture3, float a3, vec4 texture4, float a4)","{","float depth = 2.0;","float alphaMult = 1.0;","float alphaAdd  = 0.0;","a1 *= 4.0;","a2 *= 4.0;","a3 *= 4.0;","a4 *= 4.0;","a1 =  a1+(1.5+texture1.a);","a2 =  a2+(1.5+texture2.a);","a3 =  a3+(1.5+texture3.a);","a4 =  a4+(1.5+texture4.a);","float ma = max(a1,a2);","ma = max(ma,a3);","ma = max(ma,a4);","ma -= depth;","float b1 = max(a1 - ma, 0.0);","float b2 = max(a2 - ma, 0.0);","float b3 = max(a3 - ma, 0.0);","float b4 = max(a4 - ma, 0.0);","return (","texture1.rgb * b1 + texture2.rgb * b2 +","texture3.rgb * b3 + texture4.rgb * b4 ",") / (b1 + b2 + b3 + b4);","}","void main( void ) {","vec2 position = vUv*uvScale;","float edge = 1.0/1024.0;","vec2 compPos = edge + (vUv*0.25 + offset) * (1.0-edge*2.0);","vec4 tp1 = texture2D( texturePicker, compPos);","vec4 tp2 = texture2D( texturePicker2, compPos);","vec4 composite = tp1;","vec4 t1 = texture2D( texture1, position );","vec4 t2 = texture2D( texture2, position );","vec4 t3 = texture2D( texture3, position );","vec4 t4 = texture2D( texture4, position );","vec3 color = blend(","t1, tp1.a,","t2, tp1.b,","t3, tp1.g,","t4, tp1.r",");","color *= 0.5+tp2.r;","gl_FragColor = vec4(color,1.0);",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},getVertexShader:function(){return["varying vec2 vUv;","varying vec3 vecNormal;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main()","{","vUv =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n")}}},{}]},{},[8])(8)});
//# sourceMappingURL=T3D-1.1.0.js.map
