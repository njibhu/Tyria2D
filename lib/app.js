!function(){return function e(t,a,r){function n(o,s){if(!a[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(i)return i(o,!0);var d=new Error("Cannot find module '"+o+"'");throw d.code="MODULE_NOT_FOUND",d}var f=a[o]={exports:{}};t[o][0].call(f.exports,function(e){var a=t[o][1][e];return n(a||e)},f,f.exports,e,t,a,r)}return a[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)n(r[o]);return n}}()({1:[function(e,t,a){var r={};r.TYPE={},r.TYPE.UNKNWON=0,r.TYPE.TEXTURE_ATEC=257,r.TYPE.TEXTURE_ATEP=258,r.TYPE.TEXTURE_ATET=259,r.TYPE.TEXTURE_ATEU=260,r.TYPE.TEXTURE_ATEX=261,r.TYPE.TEXTURE_ATTX=262,r.TYPE.TEXTURE_DDS=288,r.TYPE.TEXTURE_PNG=289,r.TYPE.STRINGS=512,r.TYPE.BINARIES=768,r.TYPE.PACK_UNSORTED=1024,r.TYPE.PACK_ABIX=1025,r.TYPE.PACK_ABNK=1026,r.TYPE.PACK_AFNT=1027,r.TYPE.PACK_AMAT=1028,r.TYPE.PACK_AMSP=1029,r.TYPE.PACK_ANIC=1030,r.TYPE.PACK_ASND=1031,r.TYPE.PACK_CDHS=1032,r.TYPE.PACK_CINP=1033,r.TYPE.PACK_CMAC=1040,r.TYPE.PACK_CMPC=1041,r.TYPE.PACK_CNTC=1042,r.TYPE.PACK_EMOC=1043,r.TYPE.PACK_EULA=1044,r.TYPE.PACK_HVKC=1045,r.TYPE.PACK_MAPC=1046,r.TYPE.PACK_MMET=1047,r.TYPE.PACK_MODL=1048,r.TYPE.PACK_MPSD=1049,r.TYPE.PACK_PIMG=1056,r.TYPE.PACK_PRLT=1057,r.TYPE.PACK_STAR=1058,r.TYPE.PACK_TXTM=1059,r.TYPE.PACK_TXTV=1060,r.getTypeName=function(e){for(var t in r.TYPE)if(r.TYPE[t]===e)return t},r.getFileType=function(e){var t=e.readCString(4);switch(t){case"ATEC":return r.TYPE.TEXTURE_ATEC;case"ATEP":return r.TYPE.TEXTURE_ATEP;case"ATET":return r.TYPE.TEXTURE_ATET;case"ATEU":return r.TYPE.TEXTURE_ATEU;case"ATEX":return r.TYPE.TEXTURE_ATEX;case"ATTX":return r.TYPE.TEXTURE_ATTX}if(0===t.indexOf("DDS"))return r.TYPE.TEXTURE_DDS;if(0===t.indexOf("PNG"))return r.TYPE.TEXTURE_PNG;if(t.indexOf("PF"))switch(new GW2File(e,0,!0).header.type){case"ABIX":return r.TYPE.PACK_ABIX;case"ABNK":return r.TYPE.PACK_ABNK;case"AFNT":return r.TYPE.PACK_AFNT;case"AMAT":return r.TYPE.PACK_AMAT;case"AMSP":return r.TYPE.PACK_AMSP;case"anic":return r.TYPE.PACK_ANIC;case"ASND":return r.TYPE.PACK_ASND;case"CDHS":return r.TYPE.PACK_CDHS;case"CINP":return r.TYPE.PACK_CINP;case"cmaC":return r.TYPE.PACK_CMAC;case"cmpc":return r.TYPE.PACK_CMPC;case"cntc":return r.TYPE.PACK_CNTC;case"emoc":return r.TYPE.PACK_EMOC;case"eula":return r.TYPE.PACK_EULA;case"hvkC":return r.TYPE.PACK_HVKC;case"mapc":return r.TYPE.PACK_MAPC;case"mMet":return r.TYPE.PACK_MMET;case"MODL":return r.TYPE.PACK_MODL;case"mpsd":return r.TYPE.PACK_MPSD;case"PIMG":return r.TYPE.PACK_PIMG;case"prlt":return r.TYPE.PACK_PRLT;case"STAR":return r.TYPE.PACK_STAR;case"txtm":return r.TYPE.PACK_TXTM;case"txtv":case"txtV":return r.TYPE.PACK_TXTV;default:return r.TYPE.PACK_UNSORTED}return 0===t.indexOf("MZ")?r.TYPE.BINARIES:0===t.indexOf("strs")?r.TYPE.STRINGS:r.TYPE.UNKNWON},t.exports=r},{}],2:[function(e,t,a){e("../format/file/GW2File.js");var r=e("../format/definition/ANDAT"),n=e("../format/definition/MFT"),i=e("../util/MathUtils.js"),o=e("../MapFileList"),s=e("./FileIndex"),l=function(e,t){this.fileListeners=[],this.dat=e,this.version=T3D.version,this.logger=t||T3D.Logger};l.prototype.parseHeaderAsync=function(e){this.onFullyLoaded=e,this.loadFilePart(this.dat,0,40,this.readANDatHeader)},l.prototype.connectInflater=function(e){var t=this;this.inflater=e,this.inflater.addEventListener("message",function(e){t.listener.call(t,e)},!0)},l.prototype.listener=function(e){if("string"!=typeof e.data){var t=e.data[0];this.fileListeners[t]&&(this.fileListeners[t].forEach(function(t){var a=e.data;t(a[1],a[2],a[3],a[4])}),this.fileListeners[t]=null)}else this.logger.log(T3D.Logger.TYPE_WARNING,"Inflater threw an error",e.data)},l.prototype.readANDatHeader=function(e){this.fileHeader=e.readStruct(r),this.logger.log(T3D.Logger.TYPE_DEBUG,"Loaded Main .dat header",this.fileHeader),this.fileHeader.mftOffset=i.arr32To64(this.fileHeader.mftOffset),this.loadFilePart(this.dat,this.fileHeader.mftOffset,this.fileHeader.mftSize,this.readMFTHeader)},l.prototype.readMFTHeader=function(e){this.mft=e.readStruct(n);e.position;var t=this.mft.nbOfEntries;this.mft.entryDict={offset_0:new Uint32Array(t),offset_1:new Uint32Array(t),offset:new Float64Array(t),size:new Uint32Array(t),compressed:new Uint16Array(t),crc:new Uint32Array(t)},this.logger.log(T3D.Logger.TYPE_DEBUG,"reading MFT entries");for(var a=0;a<t-1;a++)this.mft.entryDict.offset_0[a]=e.readUint32(),this.mft.entryDict.offset_1[a]=e.readUint32(),this.mft.entryDict.size[a]=e.readUint32(),this.mft.entryDict.compressed[a]=e.readUint16(),this.mft.entryDict.offset[a]=i.arr32To64([this.mft.entryDict.offset_0[a],this.mft.entryDict.offset_1[a]]),e.seek(e.position+6),this.mft.entryDict.crc[a]=e.readUint32();var r=i.arr32To64([this.mft.entryDict.offset_0[1],this.mft.entryDict.offset_1[1]]),o=this.mft.entryDict.size[1];this.loadFilePart(this.dat,r,o,this.readMFTIndexFile)},l.prototype.readMFTIndexFile=function(e,t){var a=t/8,r=new Uint32Array(a),n=new Uint32Array(a),i=new Uint32Array(a),o=new Uint32Array(a);this.mft.baseToMft=new Uint32Array(2e6),this.mft.fileToMft=new Uint32Array(2e6);for(var s=0;s<a;s++)r[s]=e.readUint32(),n[s]=e.readUint32();this.mft.id2index={ids:r,mftIndices:n};for(s=0;s<a;s++)if(0!=r[s]||0!=n[s]){var l=n[s],d={fileId:o[l],baseId:i[l]};if(0==d.baseId?d.baseId=r[s]:0==d.fileId&&(d.fileId=r[s]),d.baseId>0&&d.fileId>0&&d.baseId>d.fileId){var f=d.baseId;d.baseId=d.fileId,d.fileId=f}this.mft.baseToMft[d.baseId]=l,this.mft.fileToMft[d.fileId]=l,o[l]=d.fileId,i[l]=d.baseId}this.mft.m_entryToId={baseId:i,fileId:o},this.logger.log(T3D.Logger.TYPE_DEBUG,"Finished indexing MFT ",this.mft),this.onFullyLoaded&&this.onFullyLoaded()},l.prototype.loadFileList=function(){var e=this.dat,t="fileList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size,a=localStorage.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(e){}return null},l.prototype.loadMapList=function(){var e=this.dat,t="mapList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size,a=localStorage.getItem(t);if(!a)return null;try{return JSON.parse(a)}catch(e){}return null},l.prototype.storeFileList=function(e,t){var a=JSON.stringify(t),r="fileList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size;localStorage.setItem(r,a)},l.prototype.storeMapList=function(e,t){var a="mapList_"+this.version+"."+e.name+"_"+e.lastModified+"_"+e.size;localStorage.setItem(a,JSON.stringify(t))},l.prototype.readFileListAsync=function(e){var t=this,a=this.mft.id2index.mftIndices,r=i.sort_unique(a,function(e,a){return t.mft.entryDict.offset[e]-t.mft.entryDict.offset[a]}),n=r.length;this.logger.log(T3D.Logger.TYPE_DEBUG,"Scanning ",n,"files");this.listFiles(r,null,0,n,8,function(a){t.fileListeners=[],t.storeFileList(t.dat,a),e(a)})},l.prototype.readMapListAsync=function(e,t){var a=this,r=this.dat,n=[],s=(new Date).getTime();this.logger.log(T3D.Logger.TYPE_PROGRESS,"Finding maps (first visit only)","initializing"),e?n=this.mft.id2index.mftIndices:o.maps.forEach(function(e){e.maps.forEach(function(e){var t=e.fileName.split(".")[0],r=a.getFileIndex(t);n.push(r)})});var l=i.sort_unique(n,function(e,t){return a.mft.entryDict.offset[e]-a.mft.entryDict.offset[t]}),d=l.length;this.logger.log(T3D.Logger.TYPE_DEBUG,"Scanning ",d," files for maps..."),this.listFiles(l,"mapc",0,d,8,function(e){var n=(new Date).getTime()-s;a.logger.log(T3D.Logger.TYPE_DEBUG,"Time elapsed ",Math.round(.001*n)," seconds"),a.fileListeners=[];var i={maps:[]};e.mapc&&e.mapc.forEach(function(e){var t=a.mft.m_entryToId.baseId[e+1],r="",n="";o.maps.forEach(function(e){e.maps.forEach(function(a){0==r.length&&a.fileName.indexOf(t+".")>=0&&(r=a.name,n=e.name)})}),0==r.length&&(r="Unknown map "+t),0==n.length&&(n="Unknown maps");var s=null;i.maps.forEach(function(e){e.name==n&&(s=e)}),s||(s={name:n,maps:[]},i.maps.push(s)),s.maps.push({fileName:t,name:r})}),a.storeMapList(r,i),t(i)})},l.prototype.listFiles=function(e,t,a,r,n,i){for(var o=this,l=a+r,d=0,f=100/Math.min(r,e.length-a),m=0,u={},h=function(r){if(r%n==0){var c=Math.min(100,Math.floor((r-a)*f));d!=c&&(o.logger.log(T3D.Logger.TYPE_PROGRESS,"Find type",c),d=c)}if(r>=e.length||r>=l)return o.logger.log(T3D.Logger.TYPE_DEBUG,"Thread ",r%n+" done"),void(++m==n&&i(u));var p=e[r];if(o.mft.entryDict.compressed[p]){var g=p,E=o.mft.entryDict.offset[p],T=o.mft.entryDict.size[p];T<32?h(r+n):o.loadFilePart(o.dat,E,Math.min(T,2e3),function(e,a){o.inflate(e,a,g,function(e){!function(e,a,r){if(!e)return o.logger.log(T3D.Logger.TYPE_WARNING,"No infalted data for entry"),void h(a+n);var i=new DataStream(e),l=s.getFileType(i);l=s.getTypeName(l),t&&l!=t||(u[l]||(u[l]=[]),u[l].push(r)),h(a+n)}(e,r,p)},!1,32)})}else h(r+n)},c=0;c<n;c++)h(a+c)},l.prototype.getFileIndex=function(e){var t=-1;return e=parseInt(e),-1!=(t=this.mft.m_entryToId.baseId.indexOf(e))?t-1:-1!=(t=this.mft.m_entryToId.fileId.indexOf(e))?t-1:t},l.prototype.loadTextureFile=function(e,t){this.loadFile(e,t,!0)},l.prototype.loadFile=function(e,t,a,r){var n=this,o=this.getFileIndex(e),s=o;if(s<=0)return n.logger.log(T3D.Logger.TYPE_WARNING,"Could not find file with baseId ",e),void t(null);var l=i.arr32To64([this.mft.entryDict.offset_0[s],this.mft.entryDict.offset_1[s]]),d=this.mft.entryDict.size[s];if(!this.mft.entryDict.compressed[s])return n.logger.log(T3D.Logger.TYPE_WARNING,"File is NOT compressed, skipping"),void t(null);var f=o;this.loadFilePart(this.dat,l,d,function(e,i){r?t(e):n.inflate(e,i,f,t,a)})},l.prototype.inflate=function(e,t,a,r,n,i){var o=e.buffer;if(i||(i=1),o.byteLength<12)return this.logger.log(T3D.Logger.TYPE_WARNING,"not inflating, length is too short ("+o.byteLength+")",a),void r(null);123350!=a&&123409!=a&&123408!=a?this.fileListeners[a]?this.fileListeners[a].push(r):(this.fileListeners[a]=[r],this.inflater.postMessage([a,o,!0===n,i])):r(null)},l.prototype.loadFilePart=function(e,t,a,r){var n=this,i=new FileReader;i.onerror=function(e){},i.onload=function(e){var t=e.target.result,i=new DataStream(t);i.endianness=DataStream.LITTLE_ENDIAN,r.call(n,i,a)};var o=t,s=o+a;i.readAsArrayBuffer(e.slice(o,s))},t.exports=l},{"../MapFileList":5,"../format/definition/ANDAT":15,"../format/definition/MFT":16,"../format/file/GW2File.js":18,"../util/MathUtils.js":20,"./FileIndex":1}],3:[function(e,t,a){e("../T3DLib").version;var r=function(){this.isReady=!1,this.connectDB()};function n(e,t,a,r){var n=e.transaction([t],"readwrite").objectStore(t),i=0,o=0,s=function(){if(o<a.length){a[o];o+=1;var e=n.add(obj);e.onsuccess=s,e.onerror=function(){if(i>15)throw new Error("PersistantStore generated too many errors on insert");i+=1,T3D.Logger.log(T3D.Logger.TYPE_WARNING,"PersistantStore could not store item",e.error),s()}}else r()};s()}r.prototype.connectDB=function(e){e="function"==typeof e?e:()=>{};var t=this,a=window.indexedDB.open("Tyria3DLibrary",1);a.onblocked=function(e){T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database cannot be upgraded while the app is opened somewhere else.")},a.onupgradeneeded=function(e){var t=e.target.result;e.oldVersion<1&&(t.createObjectStore("filelist",{keyPath:"baseId",unique:!0}),t.createObjectStore("maplist",{keyPath:"baseId",unique:!0}))},a.onsuccess=function(a){t._dbConnection=a.target.result,t.isReady=!0,e()},a.onerror=function(e){T3D.Logger.log(T3D.Logger.TYPE_ERROR,"The T3D persistant database could not be opened."),T3D.Logger.log(T3D.Logger.TYPE_DEBUG,a.error)}},r.prototype.getIDBDatabase=function(){return this.isReady?this._dbConnection:null},r.prototype.insertFileList=function(e,t){t="function"==typeof t?t:()=>{};var a=this.getIDBDatabase();a?n(a,"filelist",e,t):T3D.Logger.log(T3D.Logger.TYPE_ERROR,"PersistantStore: database not ready")},r.prototype.readFileList=function(e){e="function"==typeof e?e:()=>{}},r.prototype.insertMapList=function(e,t){t="function"==typeof t?t:()=>{};var a=this.getIDBDatabase();a?n(a,"maplist",itemArray,t):T3D.Logger.log(T3D.Logger.TYPE_ERROR,"PersistantStore: database not ready")},r.prototype.readMapList=function(e){e="function"==typeof e?e:()=>{}},t.exports=r},{"../T3DLib":6}],4:[function(e,t,a){var r={TYPE_ERROR:4,TYPE_WARNING:3,TYPE_MESSAGE:2,TYPE_PROGRESS:1,TYPE_DEBUG:0};r.logFunctions=new Array(5),r.log=function(){if(0!=arguments.length){var e=r.argsToArr(arguments);1==e.length&&e.unshift(r.TYPE_MESSAGE);var t=Math.max(0,Math.min(r.logFunctions.length,e.shift()));r.logFunctions[t].apply(this,e)}},r.argsToArr=function(e){for(var t=new Array(e.length),a=0;a<t.length;++a)t[a]=e[a];return t},r.logFunctions[r.TYPE_ERROR]=function(){console.error.apply(console,arguments)},r.logFunctions[r.TYPE_WARNING]=function(){console.warn.apply(console,arguments)},r.logFunctions[r.TYPE_MESSAGE]=function(){console.log.apply(console,arguments)},r.logFunctions[r.TYPE_PROGRESS]=function(){var e=r.argsToArr(arguments);e.unshift("Progress: "),console.log.apply(console,e)},r.logFunctions[r.TYPE_DEBUG]=function(){var e=r.argsToArr(arguments);console.debug.apply(console,e)},t.exports=r},{}],5:[function(e,t,a){t.exports={maps:[{name:"01. Shiverpeaks",maps:[{fileName:"125199.data",name:"Wayfarer Foothills (0)"},{fileName:"187611.data",name:"Wayfarer Foothills (1)"},{fileName:"568778.data",name:"Cragstead"},{fileName:"132434.data",name:"Hoelbrak (0)"},{fileName:"197122.data",name:"Hoelbrak (1)"},{fileName:"124093.data",name:"Snowden Drifts (0)"},{fileName:"186397.data",name:"Snowden Drifts (1)"},{fileName:"275155.data",name:"Dredgehaunt Cliffs"},{fileName:"276252.data",name:"Frostgorge Sound"},{fileName:"277587.data",name:"Lornar's Pass"},{fileName:"278717.data",name:"Timberline Falls (0)"},{fileName:"846866.data",name:"Timberline Falls (1)"},{fileName:"1018612.data",name:"Timberline Falls (2)"},{fileName:"295282.data",name:"Eye of the North"}]},{name:"02. Ascalon",maps:[{fileName:"126118.data",name:"Plains of Ashford (0)"},{fileName:"188591.data",name:"Plains of Ashford (1)"},{fileName:"127888.data",name:"Diessa Plateau (0)"},{fileName:"190490.data",name:"Diessa Plateau (1)"},{fileName:"131944.data",name:"Black Citadel (0)"},{fileName:"196585.data",name:"Black Citadel (1)"},{fileName:"280025.data",name:"Blazeridge Steppes"},{fileName:"281313.data",name:"Fireheart Rise"},{fileName:"282668.data",name:"Iron Marches"},{fileName:"283574.data",name:"Fields of Ruin"}]},{name:"03. Kryta",maps:[{fileName:"191000.data",name:"Lion's Arch (0)"},{fileName:"814803.data",name:"Lion's Arch (1)"},{fileName:"1019669.data",name:"Lion's Arch (Legacy)"},{fileName:"1796999.data",name:"Lion's Arch (2)"},{fileName:"1869665.data",name:"Lion's Arch (3)"},{fileName:"128151.data",name:"Divinity's Reach (0)"},{fileName:"191265.data",name:"Divinity's Reach (1)"},{fileName:"705746.data",name:"Divinity's Reach (2)"},{fileName:"129834.data",name:"North of Divinity's Reach (0)"},{fileName:"193081.data",name:"North of Divinity's Reach (1)"},{fileName:"129524.data",name:"Queensdale (0)"},{fileName:"192711.data",name:"Queensdale (1)"},{fileName:"130970.data",name:"Kessex Hills (0)"},{fileName:"194288.data",name:"Kessex Hills (1)"},{fileName:"672138.data",name:"Kessex Hills (2)"},{fileName:"861815.data",name:"Kessex Hills (3)"},{fileName:"286945.data",name:"Bloodtide Coast"},{fileName:"287870.data",name:"Harathi Hinterlands"},{fileName:"289176.data",name:"Gendarran Fields"},{fileName:"295005.data",name:"Chantry of Secrets"},{fileName:"294938.data",name:"Claw Island"}]},{name:"04. Maguuma Jungle",maps:[{fileName:"195149.data",name:"Caledon Forest"},{fileName:"195493.data",name:"Metrica Province"},{fileName:"922320.data",name:"Metrica Province Instance"},{fileName:"198076.data",name:"The Grove"},{fileName:"198272.data",name:"Rata Sum"},{fileName:"291064.data",name:"Mount Maelstrom"},{fileName:"292254.data",name:"Sparkfly Fen"},{fileName:"293307.data",name:"Brisban Wildlands"}]},{name:"05. Ruins of Orr",maps:[{fileName:"284829.data",name:"Straits of Devastation"},{fileName:"285089.data",name:"Malchor's Leap"},{fileName:"285634.data",name:"Cursed Shore"},{fileName:"295179.data",name:"Cathedral of Hidden Depths"},{fileName:"295962.data",name:"A Light in the Darkness"}]},{name:"06. Living World S1",maps:[{fileName:"520479.data",name:"Southsun Cove"},{fileName:"679089.data",name:"Tower of Nightmares"}]},{name:"07. Living World S2",maps:[{fileName:"836211.data",name:"Dry top (0)"},{fileName:"861770.data",name:"Dry top (1)"},{fileName:"909361.data",name:"The Silverwastes (0)"},{fileName:"996202.data",name:"The Silverwastes (1)"},{fileName:"908730.data",name:"Glint's Lair"}]},{name:"08. Heart of Maguuma",maps:[{fileName:"969663.data",name:"Verdant Brink"},{fileName:"1262460.data",name:"Hearts and Minds"},{fileName:"969964.data",name:"Unknown Airship in tree"},{fileName:"1262310.data",name:"Dragon Stand"},{fileName:"1263739.data",name:"Tarir"},{fileName:"1264291.data",name:"Tangled Depths"}]},{name:"09. Living World S3",maps:[{fileName:"1472635.data",name:"(E1) Bloodstone Fen"},{fileName:"1498071.data",name:"(E2) Taimi Simulator"},{fileName:"1498578.data",name:"(E2) Ring of Fire"},{fileName:"1605211.data",name:"(E3) Bitterfrost Frontier"},{fileName:"1645474.data",name:"(E4) Caudecus Manor"},{fileName:"1646520.data",name:"(E4) Lake Doric"},{fileName:"1682493.data",name:"(E5) Draconis Mons"},{fileName:"1682763.data",name:"(E5) Titan's Throat"},{fileName:"1734839.data",name:"(E6) White Mantle Fortress"},{fileName:"1735346.data",name:"(E6) Siren's Landing"},{fileName:"1735440.data",name:"(E6) Shining Blade Headquarters"}]},{name:"10. Crystal Desert",maps:[{fileName:"1794574.data",name:"Crystal Oasis"},{fileName:"1833034.data",name:"Desert Highlands"},{fileName:"1833726.data",name:"PoF story instances"},{fileName:"1839188.data",name:"Domain of Vabbi"},{fileName:"1840103.data",name:"Elon Riverlands"},{fileName:"1840368.data",name:"Kormir Sanctuary"},{fileName:"1842533.data",name:"The Desolation"}]},{name:"11. Living World S4",maps:[{fileName:"1901428.data",name:"(E1) Fahranur"},{fileName:"1902235.data",name:"(E1) Istan"},{fileName:"1903523.data",name:"(E1) Crystal Oasis"},{fileName:"1954984.data",name:"(E2) Desert Highlands"},{fileName:"1955224.data",name:"(E2) Inquest Lab Tower"},{fileName:"1955471.data",name:"(E2) Rata Primus"},{fileName:"1955642.data",name:"(E2) Divinity's Reach"},{fileName:"1955915.data",name:"(E2) Mount Maelstrom"},{fileName:"1956140.data",name:"(E2) Frostgorge Sound"},{fileName:"1956245.data",name:"(E2) Void"},{fileName:"1956299.data",name:"(E2) Hided Inquest Lab"},{fileName:"1957526.data",name:"(E2) Sandswept Isles"}]},{name:"12. Seasonal Activities",maps:[{fileName:"506592.data",name:"Ascent to Madness"},{fileName:"506670.data",name:"Mad King's Labyrinth (Past)"},{fileName:"662436.data",name:"Mad King's Labyrinth (Present)"},{fileName:"506739.data",name:"Mad King's Clock Tower"},{fileName:"622681.data",name:"The Crown Pavilion"},{fileName:"569756.data",name:"SAB Hub (0)"},{fileName:"636133.data",name:"SAB Hub (1)"},{fileName:"635555.data",name:"SAB World 1"},{fileName:"635960.data",name:"SAB World 2"},{fileName:"606255.data",name:"Zephyr Sanctum"},{fileName:"529896.data",name:"Tixx's Infinirarium"},{fileName:"529945.data",name:"Winter Wonderland"}]},{name:"13. Activites",maps:[{fileName:"605983.data",name:"Sanctum Sprint"},{fileName:"606030.data",name:"Basket Brawl"}]},{name:"14. Dungeons",maps:[{fileName:"126840.data",name:"Ascalonian Catacombs (0)"},{fileName:"189364.data",name:"Ascalonian Catacombs (1)"},{fileName:"275474.data",name:"Sorrow's Embrace"},{fileName:"276520.data",name:"Honor of the Waves"},{fileName:"284039.data",name:"Citadel of Flame"},{fileName:"287214.data",name:"Caudecus's Manor"},{fileName:"291284.data",name:"Twilight Arbor (0)"},{fileName:"645968.data",name:"Twilight Arbor (1)"},{fileName:"293606.data",name:"Crucible of Eternity"},{fileName:"473930.data",name:"The Ruined City of Arah"},{fileName:"473765.data",name:"Arah - Story"},{fileName:"580061.data",name:"Molten Facility"},{fileName:"595722.data",name:"Aetherblade Retreat"}]},{name:"15. Fractals",maps:[{fileName:"519839.data",name:"Fractals of the Mists"},{fileName:"697450.data",name:"Thaumanova Reactor"},{fileName:"1426653.data",name:"Cliffside Fractal"},{fileName:"1472361.data",name:"Chaos Isle Fractal"},{fileName:"1472382.data",name:"Snowblind Fractal"},{fileName:"1472406.data",name:"Swampland Fractal"},{fileName:"1498016.data",name:"Mistlock Observatory"},{fileName:"1498798.data",name:"Aetherblade/Mai Trin Fractal"},{fileName:"1605344.data",name:"Nightmare Fractal"},{fileName:"1733857.data",name:"Shattered Observatory Fractal"},{fileName:"1733961.data",name:"Mistlock Sanctuary"},{fileName:"1905739.data",name:"Molten Boss Fractal"},{fileName:"1905889.data",name:"Twilight Oasis Fractal"}]},{name:"16. Raid",maps:[{fileName:"1151420.data",name:"(W1) Spirit Vale"},{fileName:"1383309.data",name:"(W2) Salvation Pass"},{fileName:"1427048.data",name:"Special Forces Training Area"},{fileName:"1454070.data",name:"(W3) Stronghold of the Faithful"},{fileName:"1645215.data",name:"(W4) Bastion of the Penitent"},{fileName:"1906329.data",name:"(W5) Hall of Chains"}]},{name:"17. Structured PvP",maps:[{fileName:"871093.data",name:"Original Stronghold"},{fileName:"870987.data",name:"Battle of Champion's Dusk (0)"},{fileName:"1666233.data",name:"Battle of Champion's Dusk (1)"},{fileName:"132570.data",name:"Heart of the Mists (0)"},{fileName:"197249.data",name:"Heart of the Mists (1)"},{fileName:"1734729.data",name:"Heart of the Mists (2)"},{fileName:"1712986.data",name:"Hall of the Mists"},{fileName:"132710.data",name:"The Battle of Khylo (0)"},{fileName:"197402.data",name:"The Battle of Khylo (1)"},{fileName:"132837.data",name:"Forest of Niflhel (0)"},{fileName:"197545.data",name:"Forest of Niflhel (1)"},{fileName:"376916.data",name:"Legacy of the Foefire"},{fileName:"467374.data",name:"Raid on the Capricorn"},{fileName:"520609.data",name:"Temple of the Silent Storm"},{fileName:"579383.data",name:"Skyhammer (0)"},{fileName:"677968.data",name:"Skyhammer (1)"},{fileName:"1934470.data",name:"Skyhammer (2)"},{fileName:"791564.data",name:"Courtyard (0)"},{fileName:"1713054.data",name:"Courtyard (1)"},{fileName:"556199.data",name:"Spirit Watch (0)"},{fileName:"1473061.data",name:"Spirit Watch (1)"},{fileName:"506539.data",name:"Reaper's Rumble"},{fileName:"529718.data",name:"Snowball Mayhem"},{fileName:"595582.data",name:"Dragon Ball Arena"},{fileName:"617120.data",name:"Aspect Arena"},{fileName:"1644624.data",name:"Revenge of the Capricorn"},{fileName:"1704155.data",name:"Eternal Coliseum"}]},{name:"18. World vs World",maps:[{fileName:"131235.data",name:"Eternal Battlegrounds (0)"},{fileName:"195806.data",name:"Eternal Battlegrounds (1)"},{fileName:"1885693.data",name:"Eternal Battlegrounds (2)"},{fileName:"1918037.data",name:"Eternal Battlegrounds (3)"},{fileName:"131574.data",name:"Alpine Borderlands (0)"},{fileName:"641501.data",name:"Alpine Borderlands (1)"},{fileName:"1799855.data",name:"Alpine Borderlands (2)"},{fileName:"1647236.data",name:"Desert Borderlands (0)"},{fileName:"1799442.data",name:"Desert Borderlands (1)"},{fileName:"736241.data",name:"Edge of the Mists"}]},{name:"19. Guild Halls",maps:[{fileName:"1255378.data",name:"Gilded Hollow"},{fileName:"1256064.data",name:"Lost Precipice"},{fileName:"1843274.data",name:"Windswept Haven"}]},{name:"20. Concept and not released",maps:[{fileName:"122695.data",name:"Empty Plane"},{fileName:"184799.data",name:"Empty Plane v1"},{fileName:"197562.data",name:"Empty Plane v2"},{fileName:"875614.data",name:"Unknown Mists Platforms"},{fileName:"132853.data",name:"Empty Box"},{fileName:"1255516.data",name:"Guild Coliseum"},{fileName:"1498193.data",name:"Concept sPVP Map 1"},{fileName:"1513556.data",name:"Concept sPVP Map 2"},{fileName:"1513607.data",name:"Concept sPVP Map 3"},{fileName:"1513620.data",name:"Concept sPVP Map 4"},{fileName:"1513675.data",name:"Concept sPVP Map 5"},{fileName:"1712945.data",name:"Concept sPVP Map 6"}]}]}},{}],6:[function(e,t,a){(function(a){function r(){}LocalReader=e("./LocalReader/LocalReader.js"),t.exports=r;var n,i="modules/t3dtools/t3dworker.js";r.version="1.1.0",r.GW2File=e("./format/file/GW2File"),r.GW2Chunk=e("./format/file/GW2Chunk"),r.DataRenderer=e("./dataRenderer/DataRenderer"),r.EnvironmentRenderer=e("./dataRenderer/EnvironmentRenderer"),r.HavokRenderer=e("./dataRenderer/HavokRenderer"),r.PropertiesRenderer=e("./dataRenderer/PropertiesRenderer"),r.SingleModelRenderer=e("./dataRenderer/SingleModelRenderer"),r.TerrainRenderer=e("./dataRenderer/TerrainRenderer"),r.ZoneRenderer=e("./dataRenderer/ZoneRenderer"),r.StringRenderer=e("./dataRenderer/StringRenderer"),r.Logger=e("./Logger"),r.MapFileList=e("./MapFileList"),r.MaterialUtils=e("./util/MaterialUtils.js"),r.MathUtils=e("./util/MathUtils.js"),r.ParserUtils=e("./util/ParserUtils.js"),r.RenderUtils=e("./util/RenderUtils.js"),r.PersistantStore=e("./LocalReader/PersistantStore"),r.getLocalReader=function(e,t,a,r){var n=new Worker(a||i),o=new LocalReader(e,r);return o.connectInflater(n),o.parseHeaderAsync(t),o},r.getFileListAsync=function(e,t){var a=e.loadFileList();a?t(a):e.readFileListAsync(t)},r.getMapListAsync=function(e,t,a){if(a)e.readMapListAsync(!0,t);else{var r=e.loadMapList();r?t(r):e.readMapListAsync(!1,t)}},r.renderMapContentsAsync=function(e,t,a,n,i){var o={};parseInt(t)?e.loadFile(t,function(t){var i=new DataStream(t,0,DataStream.LITTLE_ENDIAN),s=new r.GW2File(i,0),l=function(t){t<a.length?r.runRenderer(a[t].renderClass,e,Object.assign(a[t].settings,{mapFile:s}),o,l.bind(this,t+1)):n(o)};l(0)}):(i||r.Logger).log(r.Logger.TYPE_ERROR,"Map id must be an integer!, was:",t)},r.runRenderer=function(e,t,a,r,n){new e(t,a,r).renderAsync(n)},r.getContextValue=function(e,t,a,r){var n=e[t.name];return n&&n[a]?n[a]:r},r.hasWebGL=function(e){if(window.WebGLRenderingContext){for(var t=document.createElement("canvas"),a=["webgl","experimental-webgl","moz-webgl","webkit-3d"],r=!1,n=0;n<4;n++)try{if((r=t.getContext(a[n]))&&"function"==typeof r.getParameter)return!e||{name:a[n],gl:r}}catch(e){}return!1}return!1},n=0,a.window&&window.indexedDB||(r.Logger.log(r.Logger.TYPE_ERROR,"T3D persistant storing and loading requires indexedDB support."),n++),"undefined"==typeof DataStream&&(r.Logger.log(r.Logger.TYPE_ERROR,"T3D core functionality requires DataStream library."),n++),"undefined"==typeof THREE&&(r.Logger.log(r.Logger.TYPE_WARNING,"T3D mesh generation requires three.js library."),n++),n<1&&r.Logger.log(r.Logger.TYPE_MESSAGE,"Tyria 3D API v"+r.version+" initialized.")}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./LocalReader/LocalReader.js":2,"./LocalReader/PersistantStore":3,"./Logger":4,"./MapFileList":5,"./dataRenderer/DataRenderer":7,"./dataRenderer/EnvironmentRenderer":8,"./dataRenderer/HavokRenderer":9,"./dataRenderer/PropertiesRenderer":10,"./dataRenderer/SingleModelRenderer":11,"./dataRenderer/StringRenderer":12,"./dataRenderer/TerrainRenderer":13,"./dataRenderer/ZoneRenderer":14,"./format/file/GW2Chunk":17,"./format/file/GW2File":18,"./util/MaterialUtils.js":19,"./util/MathUtils.js":20,"./util/ParserUtils.js":21,"./util/RenderUtils.js":22}],7:[function(e,t,a){var r=e("../format/file/GW2File"),n=t.exports=function(e,t,a,r){this.localReader=e,this.settings=t,t||(t={}),this.context=a,this.context[this.constructor.name]={},this.logger=r||T3D.Logger};n.prototype.getOutput=function(e){return this.context[e?e.name:this.constructor.name]},n.prototype.renderAsync=function(e){var t=this;this.localReader.loadFile(this.settings.id,function(a){t.getOutput().fileId=t.settings.id,t.getOutput().rawData=a;for(var n=new Uint8Array(a),i=[],o=Math.min(n.length,1e4),s=0;65535*s<o;s++)i.push(String.fromCharCode.apply(null,n.subarray(65535*s,65535*(s+1))));o<n.length&&i.push("T3D Ignored the last "+(n.length-o)+" bytes when generating this raw output"),t.getOutput().rawString=i.join();var l=new DataStream(a),d=l.readCString(4);"ATEX"==d||"ATEC"==d||"ATEP"==d||"ATET"==d||"ATEU"==d||"ATTX"==d?t.localReader.loadTextureFile(t.settings.id,function(a,r,n,i){var o={data:new Uint8Array(a),width:n,height:i};t.getOutput().image=o,e()}):0==d.indexOf("PF")?(t.getOutput().file=new r(l,0),e()):(t.getOutput().file=null,e())})}},{"../format/file/GW2File":18}],8:[function(e,t,a){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,t,a,i){n.call(this,e,t,a,i),this.mapFile=this.settings.mapFile,this.getMat=function(e){return new THREE.MeshBasicMaterial({map:e,side:THREE.BackSide,fog:!1,depthWrite:!1})},this.loadTextureWithFallback=function(t,a,n,i,o){var s=this;function l(e){t.forEach(function(t){a[t]=e})}function d(){l(s.getMat((new THREE.TextureLoader).load(i)))}l(s.getMat(r.loadLocalTexture(e,n,null,o,function(){setTimeout(d,1)})))},this.getHazeColor=function(e){var t=e&&e.dataGlobal.haze;return!t||t.length<=0?[190,160,60]:t[0].farColor},this.parseLights=function(e){var t=this;t.getOutput().lights=[];var a,r=!1;(e?e.dataGlobal.lighting:[{lights:[],backlightIntensity:1,backlightColor:[255,255,255]}]).forEach(function(e,n){if(!r){if(e.lights.forEach(function(e,a){r=!0;var n=new THREE.Color(e.color[2]/255,e.color[1]/255,e.color[0]/255),i=new THREE.DirectionalLight(n.getHex(),e.intensity);i.position.set(-e.direction[0],e.direction[2],e.direction[1]).normalize(),e.intensity,t.getOutput().lights.push(i)}),!e.lights||0==e.lights.length){[[0,1,0,.3],[1,2,1,.3],[-1,-2,-1,.3]].forEach(function(e){var a=new THREE.Color(1,1,1),r=e[3],n=new THREE.DirectionalLight(a.getHex(),r);n.position.set(e[0],e[1],e[2]).normalize(),r,t.getOutput().lights.push(n)})}e.backlightIntensity=e.backlightIntensity;var i=new THREE.Color(e.backlightIntensity*(255-e.backlightColor[2])/255,e.backlightIntensity*(255-e.backlightColor[1])/255,e.backlightIntensity*(255-e.backlightColor[0])/255);a=new THREE.AmbientLight(i)}});var n=0;a&&(n=a.color.r+a.color.g+a.color.b,this.getOutput().lights.push(a)),this.getOutput().hasLight=r||n>0},this.parseSkybox=function(e,t,a){this.getOutput().skyElements=[];var r=this.environmentChunkData&&this.environmentChunkData.dataGlobal.skyModeTex[0];r||(r={texPathNE:1930687,texPathSW:193069,texPathT:193071});var n=t.rect,i=Math.abs(n.x1-n.x2),o=Math.abs(n.y1-n.y2),s=(Math.max(i,o),[]);this.loadTextureWithFallback([1,4],s,r.texPathNE+1,"img/193068.png",a),this.loadTextureWithFallback([0,5],s,r.texPathSW+1,"img/193070.png",a),this.loadTextureWithFallback([2],s,r.texPathT+1,"img/193072.png",a),s[3]=new THREE.MeshBasicMaterial({visible:!1});var l=new THREE.BoxGeometry(1024,512,1024);l.faceVertexUvs[0].forEach(function(e,t){var a=Math.floor(t/2);0==a||1==a?e.forEach(function(e){e.x=1-e.x,e.y/=2,e.y+=.5}):5==a||4==a?e.forEach(function(e){e.y/=-2,e.y+=.5}):e.forEach(function(e){e.x=1-e.x})}),l.uvsNeedUpdate=!0;var d=new THREE.Mesh(l,s);d.translateY(256),this.getOutput().skyElements.push(d)}}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var t=this.mapFile.getChunk("env").data,a=this.mapFile.getChunk("parm").data,r=this.getHazeColor(t),n=256*r[2]*256+256*r[1]+r[0];this.getOutput().hazeColor=r,this.parseLights(t),this.parseSkybox(t,a,n),e()},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":7}],9:[function(e,t,a){var r=e("./DataRenderer");function n(e,t,a,n){r.call(this,e,t,a,n),this.mapFile=this.settings.mapFile,this.lastP=-1,this.seed=1,this.meshes=[],this.renderModels=function(e,t,a){var r;r=this.settings&&this.settings.visible?new THREE.MeshNormalMaterial({side:THREE.DoubleSide}):new THREE.MeshBasicMaterial({visible:!1}),this.parseAllModels(e,r,t,200,0,a)},this.getCollisionsForAnimation=function(e,t){for(var a=[],r=0;r<e.collisionIndices.length;r++){var n=e.collisionIndices[r],i=t[n];i.index=n,a.push(i)}return a},this.parseAllModels=function(e,t,a,r,n,i){for(var o=n;o<n+r&&o<e.length;o++){var s=Math.round(100*o/e.length);s!=this.lastP&&(this.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Collision Models ("+a+")",s),this.lastP=s);for(var l=this.animationFromGeomIndex(e[o].geometryIndex,this.geometries,this.animations),d=this.getCollisionsForAnimation(l,this.havokChunkData.collisions),f=0;f<d.length;f++){var m=d[f];this.renderMesh(m,e[o],t)}}o<e.length?window.setTimeout(this.parseAllModels.bind(this,e,t,a,r,n+r,i),10):i()},this.animationFromGeomIndex=function(e,t,a){var r=t[e].animations.length;return a[t[e].animations[r-1]]},this.renderMesh=function(e,t,a){var r=t.translate,n=t.rotate,i=32*t.scale,o=this.parseHavokMesh(e,a);o.position.set(r[0],-r[2],-r[1]),i&&o.scale.set(i,i,i),n&&(o.rotation.order="ZXY",o.rotation.set(n[0],-n[2],-n[1])),this.getOutput().meshes.push(o)},this.seedRandom=function(){var e=1e4*Math.sin(this.seed++);return e-Math.floor(e)},this.parseHavokMesh=function(e,t){var a=e.index;if(this.meshes[a])return this.meshes[a].clone();for(var r=new THREE.Geometry,n=0;n<e.vertices.length;n++){var i=e.vertices[n];r.vertices.push(new THREE.Vector3(i[0],i[2],-i[1]))}for(n=0;n<e.indices.length;n+=3){var o=e.indices[n],s=e.indices[n+1],l=e.indices[n+2];o<=e.vertices.length&&s<=e.vertices.length&&l<=e.vertices.length?r.faces.push(new THREE.Face3(o,s,l)):this.logger.log(T3D.Logger.TYPE_ERROR,"Errorus index in havok model geometry.")}return r.computeFaceNormals(),this.meshes[a]=new THREE.Mesh(r,t),this.meshes[a]}}n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.renderAsync=function(e){var t=this;this.havokChunkData=this.mapFile.getChunk("havk").data,this.getOutput().boundingBox=this.havokChunkData.boundsMax,this.meshes=[],this.getOutput().meshes=[];var a=this.havokChunkData.propModels,r=this.havokChunkData.zoneModels,n=this.havokChunkData.obsModels;n.forEach(function(e){e.scale=1}),this.geometries=this.havokChunkData.geometries,this.animations=this.havokChunkData.animations;var i=function(){t.renderModels(n,"obs",e)};t.renderModels(a,"prop",function(){t.renderModels(r,"zone",i)})},t.exports=n},{"./DataRenderer":7}],10:[function(e,t,a){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,t,a,r){n.call(this,e,t,a,r),this.mapFile=this.settings.mapFile}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var t=this;t.getOutput().meshes=[];var a=this.mapFile.getChunk("prp2").data;if(a){var n=a.propArray,i=a.propAnimArray,o=a.propInstanceArray,s=a.propMetaArray;n=n.concat(i).concat(o).concat(s),t.meshCache={},t.textureCache={};var l=-1,d=function(a){if(a>=n.length)return t.meshCache={},t.textureCache={},void e();var i=Math.round(1e3*a/n.length);if(l!=(i/=10)){var o=i+(i.toString().indexOf(".")<0?".0":"");t.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Props)",o),l=i}var s=n[a],f=function(e,t,a,r,n){var i=0!=r.lod2?r.lod2:e.lodOverride[1];if(0==e.flags&&(i=0),n&&(e=new THREE.Mesh(e.geometry,e.material)),e.updateMatrix(),e.matrixAutoUpdate=!1,t[i])t[i].add(e);else{var o=new THREE.Group;o.updateMatrix(),o.matrixAutoUpdate=!1,o.add(e),t[i]=o,a.addLevel(o,i)}return i};r.getMeshesForFilename(s.filename,s.color,t.localReader,t.meshCache,t.textureCache,!1,function(e,r,n){e&&function(e,a,r){var n={},i=new THREE.LOD,o=0;e.forEach(function(e){o=Math.max(o,f(e,n,i,s,a))}),i.addLevel(new THREE.Group,1e5),s.rotation&&(i.rotation.order="ZXY",i.rotation.set(s.rotation[0],-s.rotation[2],-s.rotation[1])),i.scale.set(s.scale,s.scale,s.scale),i.position.set(s.position[0],-s.position[2],-s.position[1]),i.boundingSphereRadius=(r&&r.radius?r.radius:1)*s.scale,i.updateMatrix(),i.matrixAutoUpdate=!1,t.getOutput().meshes.push(i),s.transforms&&s.transforms.forEach(function(a){var n={},i=new THREE.LOD,o=0;e.forEach(function(e){o=Math.max(o,f(e,n,i,s,!0))}),a.rotation&&(i.rotation.order="ZXY",i.rotation.set(a.rotation[0],-a.rotation[2],-a.rotation[1])),i.scale.set(a.scale,a.scale,a.scale),i.position.set(a.position[0],-a.position[2],-a.position[1]),i.updateMatrix(),i.matrixAutoUpdate=!1,i.boundingSphereRadius=(r&&r.radius?r.radius:1)*s.scale,i.update(i),t.getOutput().meshes.push(i)})}(e,r,n),d(a+1)})};d(0)}else renderCallback()},i.prototype.getFileIdsAsync=function(e){var t=[],a=this.mapFile.getChunk("prp2").data,r=a.propArray,n=a.propAnimArray,i=a.propInstanceArray,o=a.propMetaArray;r=r.concat(n).concat(i).concat(o);var s=function(a){if(a>=r.length)e(t);else{a%100==0&&this.logger.log(T3D.Logger.TYPE_MESSAGE,"getting ids for entry",a,"of",r.length);var n=r[a];Utils.getFilesUsedByModel(n.filename,localReader,function(e){t=t.concat(e),s(a+1)})}};s(0)},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":7}],11:[function(e,t,a){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,t,a,r){n.call(this,e,t,a,r)}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var t=this,a=this.settings.id,n={};t.getOutput().meshes=[],r.getMeshesForFilename(a,65280,t.localReader,n,{},!0,function(a,r,i){a&&a.forEach(function(e){e.boundingSphere=i,t.getOutput().meshes.push(e)}),n={},e()})},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":7}],12:[function(e,t,a){var r=e("./DataRenderer");function n(e,t,a,n){r.call(this,e,t,a,n)}n.prototype=Object.create(r.prototype),n.prototype.constructor=n,n.prototype.renderAsync=function(e){var t=this;this.settings.id;this.getOutput().strings=[],this.localReader.loadFile(this.settings.id,function(a){var r=new DataStream(a),n=r.byteLength-2;r.seek(4);for(var i=["size","uint16","decryptionOffset","uint16","bitsPerSymbol","uint16"],o=0;n-r.position>6;){var s=r.readStruct(i);if(s.size-=6,s.size>0)if(!(0!=s.decryptionOffset||16!=s.bitsPerSymbol)){var l=r.readUCS2String(s.size/2);t.getOutput().strings.push({value:l,recid:o})}o++}r.seek(r.byteLength-2),t.getOutput().language=r.readUint16(),e()})},t.exports=n},{"./DataRenderer":7}],13:[function(e,t,a){var r=e("../util/RenderUtils"),n=e("./DataRenderer"),i=e("../format/file/GW2File.js"),o=e("../util/TerrainShader.js");function s(e,t,a,s,l){n.call(this,e,t,a,s,l),this.mapFile=this.settings.mapFile,this.drawWater=function(e){var t=t||new THREE.MeshBasicMaterial({color:6009320,wireframe:!1,opacity:.35});return t.transparent=!0,r.renderRect(e,0,t)},this.parseNumChunks=function(e){e.numChunksD_1=Math.sqrt(e.dims[0]*e.chunkArray.length/e.dims[1]),e.numChunksD_2=e.chunkArray.length/e.numChunksD_1},this.loadPagedImageCallback=function(e,t){var a=this;a.getOutput().terrainTiles=[];var n=new DataStream(t),s=new i(n,0).getChunk("pgtb"),l=s&&s.data;this.mapRect=null;var d=this.mapFile.getChunk("trn").data,f=this.mapFile.getChunk("parm").data,m=this.settings.anisotropy?this.settings.anisotropy:1;this.parseNumChunks(d);var u=d.numChunksD_1,h=d.numChunksD_2,c=d.materials.materials,p=d.materials.texFileArray,g=f.rect[2]-f.rect[0],E=f.rect[3]-f.rect[1],T=g/d.numChunksD_1*1,v=E/d.numChunksD_2*1,y=0,R=[],N=new THREE.MeshLambertMaterial({side:THREE.DoubleSide,color:6710886,flatShading:!0}),P={};l&&l.strippedPages.forEach(function(e){if(e.layer<=1){var t=e.filename,n=(e.solidColor,e.coord),i=n[0]+","+n[1];if(1==e.layer&&(i+="-2"),!P[i]){var o=r.loadLocalTexture(a.localReader,t);o&&(o.anisotropy=m,o.wrapS=THREE.RepeatWrapping,o.wrapT=THREE.RepeatWrapping),P[i]=o}}});var A=function(t,n){if(t>=u&&(t=0,n++),n>=h)return a.getOutput().water=a.drawWater(a.mapRect),a.getOutput().bounds=a.mapRect,void e();var i=Math.floor(100*(n*u+t)/(u*h));a.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading Terrain",i),function(e,t){for(var n,i=t*u+e,s=Math.floor(e/4),l=Math.floor(t/4),h=c[i].loResMaterial.texIndexArray,g=(c[i].loResMaterial.materialFile,d.chunkArray[i],p[h[0]],e%4/4),E=.75-t%4/4,A=[],M=0;M<h.length/2;M++){var x=p[h[M]].filename;if(A.push(x),!P[x]){var D=r.loadLocalTexture(a.localReader,x);D&&(D.anisotropy=m,D.wrapS=THREE.RepeatWrapping,D.wrapT=THREE.RepeatWrapping),P[x]=D}}var C=s+","+l,F=s+","+l+"-2",w={color:{r:1,g:1,b:1},near:0,far:0},S=a.getOutput(T3D.EnvironmentRenderer);S.hazeColor&&(w.color.r=S.hazeColor[2]/255,w.color.g=S.hazeColor[1]/255,w.color.b=S.hazeColor[0]/255);var b=THREE.UniformsUtils.merge([THREE.UniformsLib.lights]);b.uvScale={type:"v2",value:new THREE.Vector2(8,8)},b.offset={type:"v2",value:new THREE.Vector2(g,E)},b.texturePicker={type:"t",value:P[C]},b.texturePicker2={type:"t",value:P[F]},b.texture1={type:"t",value:P[A[0]]},b.texture2={type:"t",value:P[A[1]]},b.texture3={type:"t",value:P[A[2]]},b.texture4={type:"t",value:P[A[3]]},n=new THREE.ShaderMaterial({uniforms:b,fragmentShader:o.getFragmentShader(),vertexShader:o.getVertexShader()}),R.push(n);for(var k=new THREE.PlaneBufferGeometry(T,v,32,32),L=0,_=0;_<35;_++)for(var U=0;U<35;U++)0!=U&&34!=U&&0!=_&&34!=_&&(k.attributes.position.array[3*L+2]=d.heightMapArray[y],L++),y++;var H,I=(new THREE.Matrix4).identity();I.elements[5]=-1,k.applyMatrix(I),k.computeFaceNormals(),H=new THREE.Mesh(k,N),(H=n.length?THREE.SceneUtils.createMultiMaterialObject(k,n):new THREE.Mesh(k,n)).rotation.set(Math.PI/2,0,0);var Y=f.rect[0]+T/2,O=e*T;if(H.position.x=Y+O,d.numChunksD_2%2==0){var G=f.rect[1]+v/2-0,B=t*v*1;H.position.z=B+G}else G=f.rect[1]-v/2+0,B=t*v*1,H.position.z=G+B;var W=H.position.x,K=H.position.z;a.mapRect||(a.mapRect={x1:W-T/2,x2:W+T/2,y1:K-v/2,y2:K+v/2}),a.mapRect.x1=Math.min(a.mapRect.x1,W-T/2),a.mapRect.x2=Math.max(a.mapRect.x2,W+T/2),a.mapRect.y1=Math.min(a.mapRect.y1,K-v/2),a.mapRect.y2=Math.max(a.mapRect.y2,K+v/2),H.updateMatrix(),H.updateMatrixWorld(),a.getOutput().terrainTiles.push(H)}(t,n),setTimeout(A,1,t+1,n)};A(0,0)}}s.prototype=Object.create(n.prototype),s.prototype.constructor=s,s.prototype.renderAsync=function(e){var t=this.mapFile.getChunk("trn").data.materials.pagedImage;this.localReader.loadFile(t,this.loadPagedImageCallback.bind(this,e))},s.prototype.getFileIdsAsync=function(e){var t=this.mapFile.getChunk("trn"),a=this.mapFile.getChunk("pimg"),r=[];return(a&&a.data).strippedPages.forEach(function(e){e.layer<=1&&e.filename>0&&r.push(e.filename)}),t.data.materials.texFileArray.forEach(function(e){e.filename>0&&r.push(e.filename)}),r},t.exports=s},{"../format/file/GW2File.js":18,"../util/RenderUtils":22,"../util/TerrainShader.js":23,"./DataRenderer":7}],14:[function(e,t,a){var r=e("../util/RenderUtils"),n=e("./DataRenderer");function i(e,t,a,i){n.call(this,e,t,a,i),this.mapFile=this.settings.mapFile,this.renderZone=function(e,t,a,n){var i=this,o=null;t.forEach(function(t){o||t.token!=e.defToken||(o=t)});var s=this.getModelGroups(e,o,a);i.meshCache={},i.textureCache={};var l=Object.keys(s);!function e(t){if(t>=l.length)return i.meshCache={},i.textureCache={},void n();var a=l[t],o=s[a],d=[];r.getMeshesForFilename(a,null,i.localReader,i.meshCache,i.textureCache,!1,function(a,r){a&&o.forEach(function(e,t){a.forEach(function(a,r){if(525!=a.materialFlags){var n={x:0,y:0,z:0};if(d[r])n.x=e.x-d[r].position.x,n.y=e.z-d[r].position.z,n.z=e.y-d[r].position.y;else{var i=a.geometry.clone(),s=i.attributes;d[r]={readVerts:s.position.array,verts:new Float32Array(o.length*s.position.array.length),readIndices:i.getIndex().array,indices:new Uint32Array(o.length*i.getIndex().array.length),readUVs:s.uv.array,uvs:new Float32Array(o.length*s.uv.array.length),readNormals:s.normal.array,normals:new Float32Array(o.length*s.normal.array.length),material:a.material,position:{x:e.x,y:e.y,z:e.z}}}for(var l=d[r].readVerts,f=d[r].verts,m=l.length,u=0,h=t*m;u<m;u+=3,h+=3)f[h+0]=l[u+0]+n.x,f[h+1]=l[u+1]+n.y,f[h+2]=l[u+2]+n.z;var c=d[r].readIndices,p=d[r].indices,g=c.length,E=m*t/3;for(u=0,h=t*g;u<g;u++,h++)p[h]=c[u]+E;var T=d[r].readUVs,v=d[r].uvs,y=T.length;for(u=0,h=t*y;u<y;u++,h++)v[h]=T[u];var R=d[r].readNormals,N=d[r].normals,P=R.length;for(u=0,h=t*P;u<P;u++,h++)N[h]=R[u]}})}),d.forEach(function(e){var t=new THREE.BufferGeometry;t.addAttribute("position",new THREE.BufferAttribute(e.verts,3)),t.setIndex(new THREE.BufferAttribute(e.indices,1)),t.addAttribute("normal",new THREE.BufferAttribute(e.normals,3)),t.addAttribute("uv",new THREE.BufferAttribute(e.uvs,2)),t.buffersNeedUpdate=!0,mesh=new THREE.Mesh(t,e.material),mesh.position.set(e.position.x,e.position.z,e.position.y),i.getOutput().meshes.push(mesh)}),e(t+1)})}(0)},this.getModelGroups=function(e,t,a){e.zPos;var r=a[0],n=a[1],i=48,o=e.vertRect[0]*i+r,s=(e.vertRect[2],e.vertRect[1]*-i-n);e.vertRect[3];if(0==e.encodeData.length)return{};for(var l=e.vertRect[0]-e.vertRect[2],d=(e.vertRect[1],e.vertRect[3],0),f={},m=this.getOutput(T3D.TerrainRenderer).terrainTiles,u=0;u<e.flags.length;u+=2){d+=e.flags[u];var h=e.flags[u+1];if(0!=h){var c=h>>4,p=t.layerDefArray[c-1];if(p){var g=d%l*i+o,E=Math.floor(d/l)*i+s,T=null,v=new THREE.Raycaster(new THREE.Vector3(g,1e5,E),new THREE.Vector3(0,-1,0));m.forEach(function(e){if(null===T){var t=v.intersectObject(e);t.length>0&&(T=1e5-t[0].distance)}});var y=p.modelArray[0],R=y.filename,N=(y.zOffsets,p.layerFlags,p.rotRangeX),P=p.rotRangeY,A=p.rotRangeZ,M=p.scaleRange,x=p.fadeRange;f[R]||(f[R]=[]),f[R].push({x:g,y:E,z:T,rotRangeX:N,rotRangeY:P,rotRangeZ:A,scaleRange:M,fadeRange:x})}}}return f}}i.prototype=Object.create(n.prototype),i.prototype.constructor=i,i.prototype.renderAsync=function(e){var t=this;t.getOutput().meshes=[];var a=this.mapFile.getChunk("zon2").data,r=this.mapFile.getChunk("parm").data,n=(this.mapFile.getChunk("trn").data,r.rect),i=a.zoneArray,o=a.zoneDefArray;lastPct=-1,function a(r){var s=Math.round(100*r/i.length);lastPct!=s&&(t.logger.log(T3D.Logger.TYPE_PROGRESS,"Loading 3D Models (Zone)",s),lastPct=s),r>=i.length?e():t.renderZone(i[r],o,n,a.bind(t,r+1))}(0)},t.exports=i},{"../util/RenderUtils":22,"./DataRenderer":7}],15:[function(e,t,a){t.exports=["version","uint8","magic","string:3","headerSize","uint32","unknown1","uint32","chunkSize","uint32","crc","uint32","unknown2","uint32","mftOffset",["[]","uint32",2],"mftSize","uint32","flags","uint32"]},{}],16:[function(e,t,a){t.exports=["magic","string:4","unknown1",["[]","uint32",2],"nbOfEntries","uint32","unknown2","uint32","unknown3","uint32"]},{}],17:[function(e,t,a){var r=["type","cstring:4","chunkDataSize","uint32","chunkVersion","uint16","chunkHeaderSize","uint16","offsetTableOffset","uint32"],n={ANIM:["MODL","Unknown"],GAME:["MODL","Unknown"],Main:["cntc","mMet"],SKEL:["MODL","Unknown"],TOOL:["AMAT","MODL"],main:["Unknown","Unknown","cmaC"],nvms:["Unknown","Unknown"]},i=function(e,t){this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.loadHead()};i.prototype.loadHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(r),this.headerLength=this.ds.position-this.addr},i.prototype.getDefinition=function(e){var t=0,a=n[this.header.type];if(a){t=-1;for(var r=0;r<a.length&&-1==t;r++){a[r]==e&&(t=r)}}var i=0;for(r=0;r<T3D.formats.length;r++){var o=T3D.formats[r];if(o.name==this.header.type){if(i==t&&o.versions[this.header.chunkVersion])return(new o.versions[this.header.chunkVersion]).__root;i++}}},i.prototype.loadData=function(e){var t=this.getDefinition(e);t?(this.ds.seek(this.addr+this.headerLength),this.data=this.ds.readStruct(t)):T3D.Logger.log(T3D.Logger.TYPE_WARNING,"Could not find a definition for chunk",this.header.type,"version",this.header.chunkVersion,"file name",e)},i.prototype.next=function(){try{return new i(this.ds,this.addr+8+this.header.chunkDataSize)}catch(e){}return null},t.exports=i},{}],18:[function(e,t,a){var r=e("./GW2Chunk"),n=["identifier","cstring:2","unknownField1","uint16","unknownField2","uint16","pkFileVersion","uint16","type","cstring:4"],i=function(e,t,a){this.ds=e,this.addr=t,this.data=null,this.headerLength=NaN,this.chunks=[],this.readHead(),a||this.readChunks()};i.prototype.readHead=function(){this.ds.seek(this.addr),this.header=this.ds.readStruct(n),this.headerLength=this.ds.position-this.addr},i.prototype.readChunks=function(){this.chunks=[];for(var e=new r(this.ds,this.headerLength+this.addr);null!=e&&e.header.type;)e.loadData(this.header.type),this.chunks.push(e),e=e.next()},i.prototype.getChunk=function(e){for(var t=0;t<this.chunks.length;t++)if(this.chunks[t].header.type.toLowerCase()==e.toLowerCase())return this.chunks[t];return null},i.prototype.getChunkStructs=function(){return{}},t.exports=i},{"./GW2Chunk":17}],19:[function(e,t,a){var r=t.exports={};r.getMaterial=function(e,t,a,r){if(t){var i,o=t.getChunk("dx9s"),s=t.getChunk("grmt"),l=[];if(e&&e.textures.length){for(var d=o.data.techniques[0].passes[0].effects[0],f=(o.data.shaders[d.pixelShader],[]),m=0;m<d.samplerIndex.length;m++){var u=d.samplerIndex[m],h=o.data.samplers[u];if(h){var c=h&&s.data.texTokens[h.textureIndex];c||(c="0-0");var p=null;if(e.textures.forEach(function(e,t){p||e.token.split("-")[0]!=c.split("-")[0]||(p=e)}),p)f.push(p);else if(h)f.push(e.textures[h.textureIndex]);else{if(!(e.textures.length>0))return;f.push(e.textures[0])}}}if(f.length<=0)return;f.forEach(function(e,t){if(e){var i=e&&e.filename;l[t]=n(i,a,r),l[t]&&(l[t].uvIdx=e.uvPSInputIndex)}})}if(l){var g=!1,E=!1;if(e.textures.forEach(function(e){g||"1733499172"!=e.token.split("-")[0]||(g=e),E||"404146670"!=e.token.split("-")[0]||(E=e)}),!g||g.filename<=0)return;if(i=new THREE.MeshPhongMaterial({side:THREE.FrontSide,map:n(g.filename,a,r)}),E){var T=n(E.filename,a,r);T.flipY=!0,i.normalMap=T}i.textureFilename=g.filename,16460!=s.data.flags&&(i.alphaTest=.05)}else i=new THREE.MeshBasicMaterial({side:THREE.FrontSide,color:16711680,shading:THREE.FlatShading});if(i.needsUpdate=!0,e){s=t.getChunk("grmt");1&e.materialFlags||16&e.materialFlags||e.materialFlags;[16460,16452,16448,8268,3392,2380,2368,332,324,320,76,68,64].indexOf(s.data.flags)<0&&T3D.Logger.log(T3D.Logger.TYPE_WARNING,"unknown GR flag",s.data.flags),8&s.data.flags||(i=new THREE.MeshBasicMaterial({side:THREE.FrontSide,map:i.map})),16460!=s.data.flags&&(i.alphaTest=.05)}return i}};var n=r.getTexture=function(e,t,a){var r;return e&&a[e]?r=a[e]:e&&((r=i(t,e)).wrapT=THREE.RepeatWrapping,r.wrapS=THREE.RepeatWrapping,r.flipY=!1,a[e]=r),r},i=r.loadLocalTexture=function(e,t,a,r,n){void 0===r&&(r=Math.floor(16777215*Math.random()));var i=function(e,t,a){for(var r=e*t,n=new Uint8Array(4*r),i=Math.floor(255*a.r),o=Math.floor(255*a.g),s=Math.floor(255*a.b),l=0;l<r;l++){var d=4*l;n[d]=i,n[d+1]=o,n[d+2]=s,n[d+3]=255}return new THREE.DataTexture(n,e,t,THREE.RGBAFormat)}(1,1,new THREE.Color(r));return i.minFilter=THREE.LinearMipMapLinearFilter,i.magFilter=THREE.LinearFilter,i.generateMipmaps=!0,i.flipY=!0,parseInt(t)<=0?(n&&n(),i):(e.loadTextureFile(t,function(e,t,a,r){if(e){var o={data:new Uint8Array(e),width:a,height:r};i.format=THREE.RGBAFormat,i.image=o,i.needsUpdate=!0}else n&&n()}),i)}},{}],20:[function(e,t,a){var r=t.exports={};r.f16=function(e){var t=(32768&e)>>15,a=(31744&e)>>10,r=1023&e;return 0==a?(t?-1:1)*Math.pow(2,-14)*(r/Math.pow(2,10)):31==a?r?NaN:1/0*(t?-1:1):(t?-1:1)*Math.pow(2,a-15)*(1+r/Math.pow(2,10))},r.popcount=function(e){return e=(252645135&(e=(858993459&(e-=e>>1&1431655765))+(e>>2&858993459)))+(e>>4&252645135),(e+=e>>8)+(e>>15)&63};var n=Math.pow(2,32);r.arr32To64=function(e){return n*e[1]+e[0]},r.sort_unique=function(e,t){for(var a=Array.prototype.sort.call(e,t),r={},n=[],i=0,o=a.length;i<o;++i)r.hasOwnProperty(a[i])||(n.push(a[i]),r[a[i]]=1);return n}},{}],21:[function(e,t,a){t.exports={getArrayReader:function(e,t){return function(a,r){var n=[];try{var i=a.readUint32(),o=a.readUint32();if(0==o)return n;var s=a.position-4+o,l=a.position;if(t&&i>t)throw"Array length "+i+" exceeded allowed maximum "+t;l=a.position;a.seek(s),n=a.readType(["[]",e,i],r),a.seek(l)}catch(t){console.warn("getArrayReader Failed loading array",t),console.warn("getArrayReader Failed loading array, structDef",e)}return n}},getRefArrayReader:function(e){return function(t,a){var r=[],n=t.readUint32(),i=t.position+t.readUint32();if(0==n)return r;var o=t.position;t.seek(i);var s=t.readInt32Array(n),l=o-4;t.seek(l),l+=t.readUint32();for(var d=0;d<s.length;d++)if(0!=s[d]){var f=l+4*d+s[d];t.seek(f);try{r.push(t.readStruct(e))}catch(e){r.push(null),console.warn("getRefArrayReader could not find refered data at offset",s[d],e)}}return t.seek(o),r}},getQWordReader:function(){return function(e,t){return e.readUint32()+"-"+e.readUint32()}},getStringReader:function(){return function(e,t){var a=e.position+e.readUint32(),r=e.position;e.seek(a);var n=e.readCString();return e.seek(r),n}},getString16Reader:function(e){return function(t,a){var r=t.position+t.readUint32()+(e||0),n=t.position;t.seek(r);for(var i,o="";t.position+2<t.byteLength&&0!=(i=t.readUint16());)o+=String.fromCharCode(i);return t.seek(n),o}},getPointerReader:function(e){return function(t,a){var r=t.readUint32();if(0==r)return{};var n=t.position-4+r,i=t.position;t.seek(n);var o=t.readStruct(e);return t.seek(i),o}},getFileNameReader:function(){return function(e,t){try{var a=e.position+e.readUint32(),r=e.position;e.seek(a);var n=e.readStruct(["m_lowPart","uint16","m_highPart","uint16","m_terminator","uint16"]),i=65280*(n.m_highPart-256)+(n.m_lowPart-256)+1;return i<0&&(i=0),e.seek(r),i}catch(t){return e.seek(r),-1}}}}},{}],22:[function(e,t,a){var r=e("../format/file/GW2File"),n=e("./MaterialUtils"),i=e("./MathUtils"),o={},s=1,l=2,d=4,f=8,m=16,u=32,h=64,c=128,p=65280,g=16711680,E=t.exports={},T=(E.renderRect=function(e,t,a,r){var n=e.x1-e.x2,i=e.y1-e.y2;r||(r=1);var o=(e.x1+e.x2)/2,s=(e.y1+e.y2)/2,l=t,d=new THREE.BoxGeometry(n,r,i);a=a||new THREE.MeshBasicMaterial({color:16711680,wireframe:!0});var f=new THREE.Mesh(d,a);return f.overdraw=!0,f.position.x=o,f.position.y=l,f.position.z=s,f},E.loadLocalTexture=function(e,t,a,r,i){return n.loadLocalTexture(e,t,a,r,i)},E.renderGeomChunk=function(e,t,a,r,E){var T=t.data.meshes,v=[],y=a.data.permutations[0].materials;return T.forEach(function(t){var T=t.geometry,R=T.verts.mesh.fvf,N=T.verts.vertexCount,P=T.verts.mesh.vertices,A=T.indices.indices,M=new THREE.BufferGeometry,x=new DataStream(P.buffer),D=P.length/N,C=new Float32Array(3*N),F=[],w=12*!!(R&s)+4*!!(R&l)+4*!!(R&d)+12*!!(R&f)+4*!!(R&m)+12*!!(R&u)+12*!!(R&h)+12*!!(R&c),S=(R&p)>>8,b=(R&g)>>16,k=!!S,L=!!b||!!S,_=k?S:b,U=i.popcount(_);if(U=Math.min(U,1),L)for(var H=0;H<U;H++)F[H]=new Float32Array(2*N);for(H=0;H<N;H++){x.seek(H*D);var I=x.readFloat32(),Y=x.readFloat32(),O=x.readFloat32();if(C[3*H+0]=I,C[3*H+1]=-O,C[3*H+2]=-Y,L)for(var G=0;G<U;G++){var B,W;x.seek(H*D+w+G*(k?8:4)),k?(B=x.readUint32(),W=x.readUint32()):(B=i.f16(x.readUint16()),W=i.f16(x.readUint16())),F[G][2*H+0]=B,F[G][2*H+1]=W}}var K=new Uint16Array(A.length);for(H=0;H<A.length;H+=3)K[H+0]=A[H+2],K[H+1]=A[H+1],K[H+2]=A[H+0];if(M.addAttribute("position",new THREE.BufferAttribute(C,3)),M.setIndex(new THREE.BufferAttribute(K,1)),M.computeVertexNormals(),L){for(G=0;G<U;G++){var z="uv"+(G>0?G+1:"");M.addAttribute(z,new THREE.BufferAttribute(F[G],2)),M.attributes[z].needsUpdate=!0}M.uvsNeedUpdate=!0}M.buffersNeedUpdate=!0;var j=t.materialIndex,V=y[j],X=null;V&&o[V.filename]&&(X=o[V.filename]);var q=n.getMaterial(V,X,e,r);if(!q){if(!E)return;q=new THREE.MeshLambertMaterial({color:6009320,wireframe:!1,side:THREE.DoubleSide})}var Z=new THREE.Mesh(M,q);V&&(Z.materialFlags=V.materialFlags,Z.materialFilename=V.filename),Z.materialName=t.materialName,Z.numLods=t.geometry.lods.length,Z.lodOverride=a.data.lodOverride,Z.flags=t.flags,Z.numUV=U,v.push(Z)}),v}),v=E.loadMeshFromModelFile=function(e,t,a,n,i,s){var l=[];a.loadFile(e,function(t){try{if(!t)throw"Could not find MFT entry for "+e;var d=new DataStream(t),f=new r(d,0),m=f.getChunk("modl"),u=f.getChunk("geom"),h=m.data.boundingSphere,c=h.center;h.radius+=Math.sqrt(c[0]*c[0]+Math.sqrt(c[1]*c[1]+c[2]*c[2]));var p=m.data.permutations[0].materials;!function e(t,n){if(t>=p.length)n();else{var i=p[t];o[i.filename]?e(t+1,n):a.loadFile(i.filename,function(a){if(a){var s=new DataStream(a),l=new r(s,0);o[i.filename]=l}e(t+1,n)})}}(0,function(){T(a,u,m,n,i).forEach(function(e){[0,8,9,520,2056,2057,2060,2061,2312,2316,2568,2569,2572,2573,2584,2824,2828,2840,4617,6664].indexOf(e.materialFlags),e.materialFlags,(i||2056&e.materialFlags)&&(4==e.flags||1==e.flags||e.flags,l.push(e))}),s(l,h)})}catch(t){console.warn("Failed rendering model "+e,t);var g=new THREE.Mesh(new THREE.BoxGeometry(200,2e3,200),new THREE.MeshNormalMaterial);g.flags=4,g.materialFlags=2056,g.lodOverride=[1e6,1e6],l.push(g),s(l)}})};E.getMeshesForFilename=function(e,t,a,r,n,i,o){r[e]?o(r[e].meshes,!0,r[e].boundingSphere):v(e,t,a,n,i,function(t,a){t&&(r[e]={meshes:t,boundingSphere:a}),o(t,!1,a)})},E.getFilesUsedByModel=function(e,t,a){var n=[e];t.loadFile(e,function(t){try{if(!t)throw"Could not find MFT entry for "+e;var i=new DataStream(t);new r(i,0).getChunk("modl").data.permutations[0].materials.forEach(function(e){var t=e.filename;n.push(t),e.textures.forEach(function(e){n.push(e.filename)})})}catch(e){console.warn("Could not export any data",e)}a(n)})}},{"../format/file/GW2File":18,"./MaterialUtils":19,"./MathUtils":20}],23:[function(e,t,a){t.exports={getFragmentShader:function(){return["uniform vec2 uvScale;","uniform vec2 offset;","uniform sampler2D texturePicker;","uniform sampler2D texturePicker2;","uniform sampler2D texture1;","uniform sampler2D texture2;","uniform sampler2D texture3;","uniform sampler2D texture4;",THREE.ShaderChunk.logdepthbuf_pars_fragment,"varying vec2 vUv;","varying vec3 vecNormal;","vec3 blend(","vec4 texture1, float a1, vec4 texture2, float a2,","vec4 texture3, float a3, vec4 texture4, float a4)","{","float depth = 2.0;","float alphaMult = 1.0;","float alphaAdd  = 0.0;","a1 *= 4.0;","a2 *= 4.0;","a3 *= 4.0;","a4 *= 4.0;","a1 =  a1+(1.5+texture1.a);","a2 =  a2+(1.5+texture2.a);","a3 =  a3+(1.5+texture3.a);","a4 =  a4+(1.5+texture4.a);","float ma = max(a1,a2);","ma = max(ma,a3);","ma = max(ma,a4);","ma -= depth;","float b1 = max(a1 - ma, 0.0);","float b2 = max(a2 - ma, 0.0);","float b3 = max(a3 - ma, 0.0);","float b4 = max(a4 - ma, 0.0);","return (","texture1.rgb * b1 + texture2.rgb * b2 +","texture3.rgb * b3 + texture4.rgb * b4 ",") / (b1 + b2 + b3 + b4);","}","void main( void ) {","vec2 position = vUv*uvScale;","float edge = 1.0/1024.0;","vec2 compPos = edge + (vUv*0.25 + offset) * (1.0-edge*2.0);","vec4 tp1 = texture2D( texturePicker, compPos);","vec4 tp2 = texture2D( texturePicker2, compPos);","vec4 composite = tp1;","vec4 t1 = texture2D( texture1, position );","vec4 t2 = texture2D( texture2, position );","vec4 t3 = texture2D( texture3, position );","vec4 t4 = texture2D( texture4, position );","vec3 color = blend(","t1, tp1.a,","t2, tp1.b,","t3, tp1.g,","t4, tp1.r",");","color *= 0.5+tp2.r;","gl_FragColor = vec4(color,1.0);",THREE.ShaderChunk.logdepthbuf_fragment,"}"].join("\n")},getVertexShader:function(){return["varying vec2 vUv;","varying vec3 vecNormal;",THREE.ShaderChunk.logdepthbuf_pars_vertex,"void main()","{","vUv =  uv;","vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );","vecNormal = (modelMatrix * vec4(normal, 0.0)).xyz;","gl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.logdepthbuf_vertex,"}"].join("\n")}}},{}]},{},[6]);
//# sourceMappingURL=app.js.map
